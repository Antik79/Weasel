import{c as w,a as T,u as E,n as P,b as y,j as s,z as F,p as S}from"./index-CFy-3w2c.js";import{r}from"./vendor-utils-CpUfumj7.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=w("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=w("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function O({name:m,title:L,subfolder:i}){const{t:c}=T(),[x,k]=r.useState(!0),[t,v]=r.useState(!1),[j,N]=r.useState(!1),h=r.useRef(null),g=r.useRef(null),{data:o}=E("ui-preferences",P,{revalidateOnFocus:!1,revalidateOnReconnect:!1});r.useEffect(()=>{if(o&&!j){const e=o.logPanelExpanded?.[m],a=o.logPanelExpanded?.default??!1;v(e!==void 0?e:a),N(!0)}},[o,m,j]);const C=e=>{o&&(g.current&&clearTimeout(g.current),g.current=setTimeout(async()=>{try{const a={...o,logPanelExpanded:{...o.logPanelExpanded,[m]:e}};await S(a)}catch(a){console.error("Failed to save UI preferences:",a)}},500))},R=()=>{const e=!t;v(e),j&&C(e)};r.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]);const{data:d,error:n}=E(t?`${i}-log-files`:null,()=>{const e=new URL("/api/logs",window.location.origin);return e.searchParams.set("subfolder",i),y(e.toString())},{refreshInterval:1e4,shouldRetryOnError:!1}),u=r.useMemo(()=>!d?.files||d.files.length===0?null:d.files.sort((e,a)=>a.name.localeCompare(e.name))[0],[d]),{data:p,isLoading:l,error:f}=E(t&&u?[`${i}-log`,u.name]:null,([,e])=>{const a=new URL(`/api/logs/${encodeURIComponent(e)}`,window.location.origin);return a.searchParams.set("subfolder",i),y(a.toString())},{revalidateOnFocus:!0,refreshInterval:x?2e3:void 0,shouldRetryOnError:!1});return r.useEffect(()=>{x&&t&&p&&h.current&&(h.current.scrollTop=h.current.scrollHeight)},[p,x,t]),s.jsxs("div",{className:"panel space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between cursor-pointer select-none",onClick:R,children:[s.jsxs("h3",{className:"panel-title mb-0 flex items-center gap-2",children:[t?s.jsx(b,{size:18}):s.jsx(F,{size:18}),L]}),s.jsxs("div",{className:"flex items-center gap-4",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:`tail-${i}`,className:"checkbox",checked:x,onChange:e=>k(e.target.checked),disabled:!t}),s.jsx("label",{htmlFor:`tail-${i}`,className:`text-xs ${t?"text-slate-400 cursor-pointer":"text-slate-600"}`,children:"Tail Log"})]}),s.jsx("div",{className:"text-xs text-slate-500 w-24 text-right",children:l?"Loading...":x&&t?"Live":"Paused"})]})]}),t&&s.jsxs("div",{ref:h,className:"bg-slate-950 rounded border border-slate-800 p-3 max-h-96 overflow-y-auto font-mono text-xs",children:[l&&s.jsx("p",{className:"text-slate-400",children:c("logs.loadingLog")}),!l&&n&&s.jsx("p",{className:"text-red-400",children:c("logs.errorLoadingFiles",{message:n instanceof Error?n.message:"Unknown error"})}),!l&&!n&&!d?.files?.length&&s.jsx("p",{className:"text-slate-400",children:c("logs.noLogFiles")}),!l&&!n&&d?.files?.length>0&&!u&&s.jsx("p",{className:"text-slate-400",children:c("logs.noLogFilesAvailable")}),!l&&!n&&u&&f&&s.jsx("p",{className:"text-red-400",children:c("logs.errorLoadingContent",{message:f instanceof Error?f.message:"Unknown error"})}),!l&&!n&&u&&!f&&!p&&s.jsx("p",{className:"text-slate-400",children:c("logs.logFileEmpty")}),!l&&!n&&u&&!f&&p&&s.jsx("pre",{className:"text-slate-300 whitespace-pre-wrap break-all",children:p})]})]})}export{b as C,O as L,$ as T};
