import{j as s,r as i,a as T,b as c,s as l,T as D,P as F,C as Ce}from"./index-DO9zxgcv.js";import{L as Pe}from"./LogPanel-Cs0XWVfY.js";import{R as $e,U as Be,P as Ie}from"./upload-Bs2bF51p.js";import{S as J,A as Oe}from"./search-TNXn00TS.js";import{D as Te}from"./download-BAhVRRd1.js";import{T as ae}from"./trash-2-CbcpzXyx.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";function Fe({items:g,activeId:k,onSelect:j,className:L=""}){return s.jsx("div",{className:`submenu-container ${L}`,children:g.map(u=>s.jsxs("button",{className:`submenu-tab ${k===u.id?"active":""}`,onClick:()=>j(u.id),children:[u.icon,u.label]},u.id))})}const Le=g=>c(g),ze=()=>c("/api/packages/bundles");function He(){const[g,k]=i.useState("installed"),[j,L]=i.useState(""),[u,te]=i.useState(""),[z,M]=i.useState(!1),[y,E]=i.useState([]),[ne,le]=i.useState(""),[S,w]=i.useState(!1),[C,v]=i.useState(null),[m,P]=i.useState(null),[$,q]=i.useState(""),[H,V]=i.useState(""),[ie,Q]=i.useState(!1),[re,K]=i.useState(!1),[o,f]=i.useState(new Set),[x,h]=i.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},variant:"info"}),{data:p,mutate:B,isLoading:ce,error:W}=T("/api/packages",Le,{revalidateOnFocus:!1}),A=i.useCallback(e=>{if(!(!p||!Array.isArray(p)))return p.find(a=>a.identifier.toLowerCase()===e.toLowerCase())},[p]),oe=i.useCallback(e=>{const a=A(e.id);return!a||!e.version?!1:e.version!==a.version},[A]),{data:d,mutate:N}=T("bundles",ze,{revalidateOnFocus:!1}),de=()=>{const e=new URL("/api/logs",window.location.origin);return c(e.toString())},{data:ue}=T(C?["logs-general",C]:null,de,{refreshInterval:1e3}),_=ue?.files??[],G=_.length>0?[..._].sort((e,a)=>a.name.localeCompare(e.name))[0]:null,{data:U,isLoading:I}=T(C&&G?["log-content",G.name]:null,([,e])=>{const a=new URL(`/api/logs/${encodeURIComponent(e)}`,window.location.origin);return c(a.toString())},{revalidateOnFocus:!0,refreshInterval:1e3}),me=i.useMemo(()=>{if(!p||!Array.isArray(p))return[];if(!j)return p;const e=j.toLowerCase();return p.filter(a=>a.displayName.toLowerCase().includes(e)||a.identifier.toLowerCase().includes(e)||a.publisher.toLowerCase().includes(e)||a.version.toLowerCase().includes(e))},[p,j]),b=i.useMemo(()=>!m||!d?null:d.find(e=>e.id===m),[m,d]),X=i.useCallback(async()=>{if(!u.trim()){E([]),f(new Set);return}M(!0);try{const e=await c(`/api/packages/search?query=${encodeURIComponent(u)}`);E(e||[]),f(new Set)}catch(e){console.error("Search failed:",e),l(`Search failed: ${e instanceof Error?e.message:String(e)}`,"error"),E([]),f(new Set)}finally{M(!1)}},[u]),xe=e=>{f(a=>{const n=new Set(a);return n.has(e)?n.delete(e):n.add(e),n})},he=()=>{f(new Set(y.map(e=>e.id)))},pe=()=>{f(new Set)},ge=async()=>{o.size!==0&&h({isOpen:!0,title:"Install Packages",message:`Install ${o.size} package(s)? This may take a while.`,onConfirm:async()=>{w(!0),v("batch-install");try{const e=[];for(const t of o)try{const r=await c("/api/packages/install",{method:"POST",body:JSON.stringify({identifier:t})});e.push(r)}catch(r){e.push({succeeded:!1,exitCode:-1,message:r instanceof Error?r.message:String(r)})}const a=e.filter(t=>t.succeeded).length,n=e.filter(t=>!t.succeeded).length;n===0?l(`Installation complete: ${a} package(s) installed successfully`,"success"):l(`Installation complete: ${a} succeeded, ${n} failed`,"warning"),f(new Set),await B(),v(null),h(t=>({...t,isOpen:!1}))}catch(e){l(`Failed to install packages: ${e instanceof Error?e.message:String(e)}`,"error"),v(null)}finally{w(!1)}},variant:"info"})},fe=async e=>{if(o.size!==0)try{const a=await c(`/api/packages/bundles/${e}`),n=y.filter(t=>o.has(t.id)).map(t=>({id:t.id,name:t.name,version:t.version??null,publisher:t.publisher??null}));await c(`/api/packages/bundles/${e}`,{method:"PUT",body:JSON.stringify({packages:[...a.packages,...n]})}),await N(),f(new Set),l(`Added ${n.length} package(s) to bundle "${a.name}"`,"success")}catch(a){l(`Failed to add packages to bundle: ${a instanceof Error?a.message:String(a)}`,"error")}},O=async(e,a)=>{const n=a??ne;if(n){w(!0),e==="/install"&&v(n);try{const t=await c(`/api/packages${e}`,{method:"POST",body:JSON.stringify({identifier:n})});t.succeeded?l(`${n} ${e==="/install"?"installed":"uninstalled"} successfully.`,"success"):l(`Failed to ${e==="/install"?"install":"uninstall"} ${n}. Error: ${t.message.split(`
`)[0]}`,"error"),await B(),e==="/install"&&v(null)}catch(t){l(`Failed to ${e==="/install"?"install":"uninstall"} ${n}: ${t instanceof Error?t.message:String(t)}`,"error"),e==="/install"&&v(null)}finally{w(!1)}}},be=async()=>{if(!$.trim()){l("Please enter a bundle name","warning");return}Q(!0);try{const e=await c("/api/packages/bundles",{method:"POST",body:JSON.stringify({name:$,description:H})});P(e.id),q(""),V(""),await N(),k("bundles"),l("Bundle created successfully","success")}catch(e){l(`Failed to create bundle: ${e instanceof Error?e.message:String(e)}`,"error")}finally{Q(!1)}},je=async e=>{if(!m||!e)return;const a={id:e.id,name:e.name,version:e.version??null,publisher:e.publisher??null};try{const n=await c(`/api/packages/bundles/${m}`,{method:"PUT",body:JSON.stringify({packages:[...b?.packages||[],a]})});await N(),l(`Added ${e.name} to bundle`,"success")}catch(n){l(`Failed to add package to bundle: ${n instanceof Error?n.message:String(n)}`,"error")}},ye=async e=>{if(!(!m||!b))try{await c(`/api/packages/bundles/${m}`,{method:"PUT",body:JSON.stringify({packages:b.packages.filter(a=>a.id!==e)})}),await N(),l("Package removed from bundle","success")}catch(a){l(`Failed to remove package from bundle: ${a instanceof Error?a.message:String(a)}`,"error")}},[Y,Z]=i.useState(null),ve=async e=>{Z(e),h({isOpen:!0,title:"Install Bundle",message:"Install all packages in this bundle? This may take a while.",onConfirm:async()=>{if(Y){K(!0);try{const a=await c(`/api/packages/bundles/${Y}/install`,{method:"POST"}),n=a.filter(r=>r.succeeded).length,t=a.filter(r=>!r.succeeded).length;t===0?l(`Bundle installation complete: ${n} package(s) installed successfully`,"success"):l(`Bundle installation complete: ${n} succeeded, ${t} failed`,"warning"),await B(),Z(null),h({...x,isOpen:!1})}catch(a){l(`Failed to install bundle: ${a instanceof Error?a.message:String(a)}`,"error")}finally{K(!1)}}},variant:"info"})},[R,ee]=i.useState(null),Ne=async e=>{ee(e),h({isOpen:!0,title:"Delete Bundle",message:"Are you sure you want to delete this bundle?",onConfirm:async()=>{if(R)try{await c(`/api/packages/bundles/${R}`,{method:"DELETE"}),await N(),m===R&&P(null),l("Bundle deleted successfully","success"),ee(null),h({...x,isOpen:!1})}catch(a){l(`Failed to delete bundle: ${a instanceof Error?a.message:String(a)}`,"error")}},variant:"danger"})},ke=e=>{const a=JSON.stringify(e,null,2),n=new Blob([a],{type:"application/json"}),t=URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=`${e.name.replace(/[^a-z0-9]/gi,"_")}.json`,r.click(),URL.revokeObjectURL(t)},Se=async()=>{const e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async a=>{const n=a.target.files?.[0];if(n)try{const t=await n.text(),r=JSON.parse(t),se=await c("/api/packages/bundles",{method:"POST",body:JSON.stringify({name:r.name,description:r.description})});r.packages.length>0&&await c(`/api/packages/bundles/${se.id}`,{method:"PUT",body:JSON.stringify({packages:r.packages})}),await N(),P(se.id),k("bundles"),l("Bundle imported successfully","success")}catch(t){l(`Failed to import bundle: ${t instanceof Error?t.message:String(t)}`,"error")}},e.click()},we=[{id:"installed",label:"Installed Packages",icon:s.jsx(F,{size:16})},{id:"install",label:"Search Packages",icon:s.jsx(J,{size:16})},{id:"bundles",label:"Bundles",icon:s.jsx(Oe,{size:16})}];return s.jsxs("section",{className:"space-y-4",children:[s.jsx(Fe,{items:we,activeId:g,onSelect:e=>k(e)}),W&&s.jsxs("p",{className:"text-sm text-red-400",children:["Failed to load packages: ",String(W)]}),g==="installed"&&s.jsxs("div",{className:"panel",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"panel-title mb-0",children:"Installed Packages"}),s.jsx("button",{className:"icon-btn",onClick:()=>B(),title:"Refresh",children:s.jsx($e,{size:16})})]}),s.jsx("div",{className:"mb-3",children:s.jsx("input",{className:"w-full input-text",placeholder:"Search installed packages by name, ID, publisher, or version...",value:j,onChange:e=>L(e.target.value)})}),s.jsx(D,{data:me,columns:[{key:"displayName",label:"Application",sortable:!0,sortFn:(e,a)=>e.displayName.localeCompare(a.displayName),render:e=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{size:16,className:"text-sky-300 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-white",children:e.displayName}),s.jsxs("p",{className:"text-xs text-slate-400",children:[e.version," · ",e.publisher]})]})]})},{key:"version",label:"Version",sortable:!0,sortFn:(e,a)=>e.version.localeCompare(a.version),render:e=>s.jsx("span",{children:e.version})},{key:"actions",label:"Actions",sortable:!1,render:e=>s.jsx("button",{className:"btn-outline",onClick:()=>{le(e.identifier),O("/uninstall")},disabled:S,children:"Remove"})}],keyExtractor:e=>e.identifier,isLoading:ce,emptyMessage:"No packages found",maxHeight:"max-h-96"})]}),g==="install"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"panel space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("h3",{className:"panel-title mb-0 flex items-center gap-2",children:[s.jsx(J,{size:18})," Search Packages"]})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{className:"flex-1 input-text",placeholder:"Search for packages (e.g. chrome, firefox, vscode)...",value:u,onChange:e=>te(e.target.value),onKeyDown:e=>{e.key==="Enter"&&X()}}),s.jsxs("button",{className:"btn-primary",onClick:X,disabled:z||!u.trim(),children:[s.jsx(J,{size:16})," ",z?"Searching…":"Search"]})]})]}),y.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"panel",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm text-slate-400",children:[o.size," of ",y.length," selected"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:"btn-outline text-xs",onClick:he,disabled:o.size===y.length,children:"Select All"}),s.jsx("button",{className:"btn-outline text-xs",onClick:pe,disabled:o.size===0,children:"Clear"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[o.size>0&&d&&d.length>0&&s.jsxs("select",{className:"btn-outline text-xs",value:"",onChange:e=>{const a=e.target.value;a&&fe(a),e.target.value=""},children:[s.jsx("option",{value:"",children:"Add selected to bundle..."}),d.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),o.size>0&&s.jsxs("button",{className:"btn-primary text-xs",onClick:ge,disabled:S,children:["Install Selected (",o.size,")"]})]})]}),s.jsx(D,{data:y,columns:[{key:"select",label:"",sortable:!1,render:e=>s.jsx("input",{type:"checkbox",checked:o.has(e.id),onChange:()=>xe(e.id),className:"checkbox"})},{key:"name",label:"Package",sortable:!0,sortFn:(e,a)=>e.name.localeCompare(a.name),render:e=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{size:16,className:"text-green-400 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-white",children:e.name}),s.jsxs("p",{className:"text-xs text-slate-400",children:[e.id," ",e.description&&`· ${e.description}`]})]})]})},{key:"version",label:"Version",sortable:!0,sortFn:(e,a)=>e.version.localeCompare(a.version),render:e=>s.jsx("span",{children:e.version})},{key:"publisher",label:"Publisher",sortable:!0,sortFn:(e,a)=>e.publisher.localeCompare(a.publisher),render:e=>s.jsx("span",{children:e.publisher})},{key:"actions",label:"Actions",sortable:!1,render:e=>{const a=A(e.id),n=oe(e);return s.jsxs("div",{className:"flex gap-2",children:[a?s.jsxs(s.Fragment,{children:[n&&s.jsx("button",{className:"btn-primary text-xs",onClick:()=>O("/install",e.id),disabled:S,title:`Update from ${a.version} to ${e.version}`,children:"Update"}),s.jsx("button",{className:"btn-outline text-xs text-red-400 hover:text-red-300",onClick:()=>{h({isOpen:!0,title:"Uninstall Package",message:`Uninstall ${e.name}?`,onConfirm:async()=>{await O("/uninstall",e.id),h({...x,isOpen:!1})},variant:"danger"})},disabled:S,children:"Uninstall"})]}):s.jsx("button",{className:"btn-primary text-xs",onClick:()=>O("/install",e.id),disabled:S,children:"Install"}),d&&d.length>0&&s.jsxs("select",{className:"btn-outline text-xs",value:"",onChange:t=>{t.target.value&&je(e),t.target.value=""},children:[s.jsx("option",{value:"",children:"Add to bundle..."}),d.map(t=>s.jsx("option",{value:t.id,children:t.name},t.id))]})]})}}],keyExtractor:e=>e.id,isLoading:z,emptyMessage:"No results found. Try a different search query.",maxHeight:"max-h-96"})]}),C&&s.jsxs("div",{className:"panel space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"panel-title mb-0",children:"Installation Log"}),s.jsx("div",{className:"text-xs text-slate-400",children:I?"Loading...":"Tailing log (auto-refreshing every second)"})]}),s.jsxs("div",{className:"bg-slate-950 rounded border border-slate-800 p-3 max-h-64 overflow-y-auto",children:[I&&s.jsx("p",{className:"text-sm text-slate-400",children:"Loading log..."}),!I&&!U&&s.jsx("p",{className:"text-sm text-slate-400",children:"No log content available"}),!I&&U&&s.jsx("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap font-mono",children:U})]})]})]})]}),g==="bundles"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"panel space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"panel-title mb-0",children:"Create Bundle"}),s.jsxs("button",{className:"btn-outline",onClick:Se,children:[s.jsx(Be,{size:16})," Import Bundle"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{className:"flex-1 input-text",placeholder:"Bundle name",value:$,onChange:e=>q(e.target.value)}),s.jsx("input",{className:"flex-1 input-text",placeholder:"Description (optional)",value:H,onChange:e=>V(e.target.value)}),s.jsxs("button",{className:"btn-primary",onClick:be,disabled:ie||!$.trim(),children:[s.jsx(Ie,{size:16})," Create"]})]})]}),d&&d.length>0&&s.jsxs("div",{className:"panel space-y-4",children:[s.jsx("h3",{className:"panel-title mb-0",children:"Bundles"}),s.jsx("div",{className:"space-y-3",children:d.map(e=>s.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${m===e.id?"border-sky-500 bg-sky-900/20":"border-slate-800 hover:border-slate-700"}`,onClick:()=>P(e.id),children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold text-white",children:e.name}),e.description&&s.jsx("p",{className:"text-sm text-slate-400 mt-1",children:e.description}),s.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:[e.packages.length," package",e.packages.length!==1?"s":""]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:"btn-outline text-xs",onClick:a=>{a.stopPropagation(),ke(e)},children:s.jsx(Te,{size:14})}),s.jsx("button",{className:"btn-outline text-xs",onClick:a=>{a.stopPropagation(),ve(e.id)},disabled:re,children:"Install All"}),s.jsx("button",{className:"btn-outline text-xs text-red-400",onClick:a=>{a.stopPropagation(),Ne(e.id)},children:s.jsx(ae,{size:14})})]})]})},e.id))})]}),b&&s.jsxs("div",{className:"panel space-y-4",children:[s.jsxs("h3",{className:"panel-title mb-0",children:[b.name," - Packages"]}),b.packages.length===0?s.jsx("p",{className:"text-sm text-slate-400",children:"No packages in this bundle. Search for packages and add them to this bundle."}):s.jsx(D,{data:b.packages,columns:[{key:"name",label:"Package",sortable:!0,sortFn:(e,a)=>e.name.localeCompare(a.name),render:e=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{size:16,className:"text-amber-300 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-white",children:e.name}),s.jsx("p",{className:"text-xs text-slate-400",children:e.id})]})]})},{key:"version",label:"Version",sortable:!0,sortFn:(e,a)=>(e.version||"").localeCompare(a.version||""),render:e=>s.jsx("span",{children:e.version||"—"})},{key:"actions",label:"Actions",sortable:!1,render:e=>s.jsx("button",{className:"btn-outline text-xs text-red-400",onClick:()=>ye(e.id),children:s.jsx(ae,{size:14})})}],keyExtractor:e=>e.id,isLoading:!1,emptyMessage:"No packages",maxHeight:"max-h-64"})]})]}),s.jsx(Pe,{name:"Packages",title:"Package Operations Log",subfolder:"Packages"}),s.jsx(Ce,{isOpen:x.isOpen,title:x.title,message:x.message,onConfirm:x.onConfirm,onCancel:()=>h({...x,isOpen:!1}),variant:x.variant})]})}export{He as default};
