import{a as ae,r as a,u as U,b as G,j as e,R as $,A as N,d as S,P as B,F as oe,f as ne,e as le,t as ie}from"./index-DKeW84DF.js";import{A as re,S as ce}from"./search-BJi76JlG.js";import{F as de}from"./folder-B7Dr_8Fd.js";import{D as Q}from"./download-DmwmVO9W.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";const me=r=>{const o=new URL("/api/logs",window.location.origin);return r&&o.searchParams.set("subfolder",r),G(o.toString())},q=(r,o)=>{const m=ie(),l=new URL(`/api/logs/${encodeURIComponent(r)}`,window.location.origin);o&&l.searchParams.set("subfolder",o),m&&l.searchParams.set("token",m),window.open(l.toString(),"_blank")};function je(){const{t:r}=ae(),[o,m]=a.useState(null),[l,g]=a.useState(null),[h,H]=a.useState(""),[c,O]=a.useState({key:"name",direction:"asc"}),[u,X]=a.useState({key:"name",direction:"asc"}),[_,C]=a.useState(33),[P,F]=a.useState(!1),b=a.useRef(null),[f,J]=a.useState(()=>{const s=localStorage.getItem("weasel.logs.foldersPageSize");return s?parseInt(s):50}),[y,R]=a.useState(1),[p,K]=a.useState(()=>{const s=localStorage.getItem("weasel.logs.filesPageSize");return s?parseInt(s):50}),[L,I]=a.useState(1),{data:k,isLoading:x,mutate:V}=U(["logs",o],()=>me(o??void 0),{refreshInterval:15e3}),d=k?.files??[];k?.folder;const M=k?.subfolders??[],{data:Y,isLoading:A}=U(l?["log",l,o]:null,([,s,t])=>{const n=new URL(`/api/logs/${encodeURIComponent(s)}`,window.location.origin);return t&&n.searchParams.set("subfolder",t),G(n.toString())},{revalidateOnFocus:!0,refreshInterval:2e3});a.useEffect(()=>{!l&&d.length>0&&g(d[0].name)},[l,d]),a.useEffect(()=>{if(!P)return;const s=n=>{if(!b.current)return;const i=b.current.getBoundingClientRect(),j=(n.clientX-i.left)/i.width*100,T=Math.max(20,Math.min(60,j));C(T),localStorage.setItem("weasel.logs.leftPanelWidth",T.toString())},t=()=>{F(!1)};return document.addEventListener("mousemove",s),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",t)}},[P]),a.useEffect(()=>{const s=localStorage.getItem("weasel.logs.leftPanelWidth");s&&C(parseInt(s))},[]);const v=a.useMemo(()=>{const s=[...M];return o&&!o.includes("/Archive")&&s.push(`${o}/Archive`),s.sort((t,n)=>{let i=0;switch(u.key){case"name":i=t.localeCompare(n);break;case"date":i=t.localeCompare(n);break}return u.direction==="asc"?i:-i})},[M,o,u]),E=a.useMemo(()=>{if(!Array.isArray(d))return[];if(!h)return d;const s=h.toLowerCase();return d.filter(t=>t.name.toLowerCase().includes(s))},[d,h]),w=a.useMemo(()=>[...E].sort((s,t)=>{let n=0;switch(c.key){case"name":n=s.name.localeCompare(t.name);break;case"size":n=s.sizeBytes-t.sizeBytes;break;case"date":n=new Date(s.lastModified).getTime()-new Date(t.lastModified).getTime();break}return c.direction==="asc"?n:-n}),[E,c]),D=a.useMemo(()=>{if(f===0)return v;const s=(y-1)*f,t=s+f;return v.slice(s,t)},[v,f,y]),W=a.useMemo(()=>{if(p===0)return w;const s=(L-1)*p,t=s+p;return w.slice(s,t)},[w,p,L]),z=s=>{O(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},Z=s=>{X(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},ee=s=>{J(s),R(1),localStorage.setItem("weasel.logs.foldersPageSize",s.toString())},se=s=>{K(s),I(1),localStorage.setItem("weasel.logs.filesPageSize",s.toString())},te=()=>{F(!0)};return a.useEffect(()=>{g(null)},[o]),e.jsx("section",{className:"space-y-4",children:e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded border border-slate-800 overflow-hidden",children:[e.jsxs("span",{className:"text-slate-500 flex-shrink-0",children:[r("common.path"),":"]}),e.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0 overflow-hidden",children:[e.jsx("button",{className:"text-sm font-medium text-sky-400 hover:text-sky-300 hover:underline flex-shrink-0",onClick:()=>{m(null),g(null)},title:"Go to root",children:"Logs"}),o&&o.split("/").filter(Boolean).map((s,t,n)=>{const i=n.slice(0,t+1).join("/"),j=t===n.length-1;return e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 min-w-0",children:[e.jsx("span",{className:"text-slate-500 flex-shrink-0",children:"/"}),e.jsx("button",{className:`text-sm font-medium truncate max-w-[150px] ${j?"text-white":"text-sky-400 hover:text-sky-300 hover:underline"}`,onClick:()=>{j||(m(i),g(null))},disabled:j,title:i,children:s})]},t)})]}),e.jsx("div",{className:"flex gap-2 flex-shrink-0",children:e.jsx("button",{className:"icon-btn",onClick:()=>V(),title:r("common.refresh"),children:e.jsx($,{size:16})})})]}),e.jsxs("div",{ref:b,className:"flex flex-row gap-2",style:{height:"calc(100vh - 200px)",minHeight:"600px"},children:[e.jsxs("div",{className:"panel flex flex-col overflow-hidden",style:{width:`${_}%`,minWidth:"250px"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 flex-shrink-0",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Folders"}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>Z("name"),children:["Name ",u.key==="name"&&(u.direction==="asc"?e.jsx(N,{size:12}):e.jsx(S,{size:12}))]})})]}),e.jsxs("div",{className:"divide-y divide-slate-800 overflow-y-auto flex-1 pr-2",children:[x&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:"Loading…"}),!x&&D.length===0&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:"No folders"}),!x&&D.map(s=>{const t=s.toLowerCase().includes("archive"),n=s.split("/").pop()||s;return e.jsx("div",{className:`item-row hover:bg-slate-800/50 cursor-pointer ${o===s?"bg-slate-800/70":""}`,onClick:()=>{m(s),g(null)},children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t?e.jsx(re,{size:18,className:"text-amber-300 flex-shrink-0"}):e.jsx(de,{size:18,className:"text-amber-300 flex-shrink-0"}),e.jsx("div",{className:"min-w-0",children:e.jsx("p",{className:"font-medium truncate",children:n})})]})},s)})]}),e.jsx(B,{currentPage:y,totalItems:v.length,pageSize:f,onPageChange:R,onPageSizeChange:ee})]}),e.jsx("div",{className:"w-2 cursor-col-resize bg-slate-900 hover:bg-sky-500/50 transition-colors flex items-center justify-center z-10 flex-shrink-0 rounded",onMouseDown:te,children:e.jsx("div",{className:"h-8 w-1 bg-slate-600 rounded-full"})}),e.jsxs("div",{className:"panel flex-1 flex flex-col overflow-hidden",style:{minWidth:"400px"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 flex-shrink-0",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Log Files"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>z("name"),children:["Name ",c.key==="name"&&(c.direction==="asc"?e.jsx(N,{size:12}):e.jsx(S,{size:12}))]}),e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>z("size"),children:["Size ",c.key==="size"&&(c.direction==="asc"?e.jsx(N,{size:12}):e.jsx(S,{size:12}))]}),e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>z("date"),children:["Date ",c.key==="date"&&(c.direction==="asc"?e.jsx(N,{size:12}):e.jsx(S,{size:12}))]})]})]}),e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search log files...",value:h,onChange:s=>H(s.target.value),className:"w-full px-3 py-2 pl-9 bg-slate-900/50 border border-slate-800 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent"}),e.jsx(ce,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"})]})}),e.jsxs("div",{className:"divide-y divide-slate-800 overflow-y-auto flex-1 pr-2",children:[x&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:"Loading…"}),!x&&W.length===0&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:h?"No files match your search":"No log files"}),!x&&W.map(s=>e.jsxs("div",{className:`item-row hover:bg-slate-800/50 cursor-pointer group ${l===s.name?"bg-slate-800/70":""}`,onClick:()=>g(s.name),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(oe,{size:18,className:"text-blue-300 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[ne(s.lastModified)," • ",le(s.sizeBytes)]})]})]}),e.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{className:"icon-btn",onClick:t=>{t.stopPropagation(),q(s.name,o)},title:"Download",children:e.jsx(Q,{size:14})})})]},s.name))]}),e.jsx(B,{currentPage:L,totalItems:w.length,pageSize:p,onPageChange:I,onPageSizeChange:se})]})]}),l&&e.jsxs("div",{className:"bg-slate-950/70 border border-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"font-semibold text-white",children:l}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{className:"btn-outline",onClick:()=>q(l,o),children:[e.jsx(Q,{size:16})," ",r("tools.logs.download")]})})]}),A&&e.jsx("p",{className:"text-sm text-slate-400",children:r("tools.logs.loadingEntry")}),!A&&e.jsx("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap max-h-[400px] overflow-y-auto font-mono bg-slate-900/50 p-3 rounded border border-slate-800",children:Y||""}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500 flex items-center gap-2",children:[e.jsx($,{size:12,className:"animate-spin"}),e.jsx("span",{children:"Tailing log (auto-refreshing every 2 seconds)"})]})]})]})})}export{je as default};
