const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TerminalViewer-DLskG58q.js","assets/index-Ce5nNHDR.js","assets/vendor-terminal-Co9mG8Of.js","assets/vendor-terminal-C0BCwPpi.css","assets/vendor-utils-BeCPKUKe.js","assets/index-UuFG_-K8.css"])))=>i.map(i=>d[i]);
import{c as E,r,a as U,b as w,j as e,X as W,i as H,u as ue,M as ee,H as ce,k as se,R as K,f as Z,g as pe,C as fe,s as k,l as be,e as $,m as te,n as ae,_ as ge}from"./index-Ce5nNHDR.js";import{C as de,L as je,S as Q,F as me,a as ve}from"./FolderPicker-Bh-PTyW0.js";import{F as ye}from"./folder-CipFuzDb.js";import{D as le}from"./download-DAaXhITR.js";import{T as J}from"./trash-2-ipkrqlV7.js";import{E as he}from"./eye-CrgTV1J3.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=E("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=E("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=E("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=E("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=E("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=E("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=E("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=E("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),Ce=s=>w(`/api/fs?path=${encodeURIComponent(s)}`),Pe=()=>w("/api/fs/drives");function Ae({initialPath:s,onSelect:v,onCancel:S,fileExtensions:M}){const[n,y]=r.useState(()=>{if(s){const i=s.lastIndexOf("\\");if(i>0)return s.substring(0,i)}return""}),F=n||"drives",{data:D,error:d,isLoading:u}=U(F,n?()=>Ce(n):Pe),f=D?.filter(i=>{if(i.isDirectory||!M||M.length===0)return!0;const p=i.name.substring(i.name.lastIndexOf(".")).toLowerCase();return M.some(N=>N.toLowerCase()===p)})||[],P=f.filter(i=>i.isDirectory),C=f.filter(i=>!i.isDirectory),L=i=>{y(i)},T=i=>{v(i.fullPath)},x=()=>{if(!n)return;const i=n.split(/[/\\]/);if(i.pop(),i.length===0||i.length===1&&i[0]==="")y("");else{const p=i.join("\\")||"";n.endsWith(":\\")||n.length===2&&n[1]===":"?y(""):y(p)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between bg-slate-800 rounded-t-lg",children:[e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(ie,{className:"text-blue-400",size:20}),"Select File"]}),e.jsx("button",{onClick:S,className:"text-slate-400 hover:text-white",children:e.jsx(W,{size:20})})]}),e.jsxs("div",{className:"p-2 bg-slate-800 border-b border-slate-700 flex gap-2 items-center",children:[e.jsx("button",{onClick:x,disabled:!n,className:"p-2 hover:bg-slate-700 rounded text-slate-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Go Up",children:e.jsx(de,{size:20})}),e.jsx("div",{className:"flex-1 bg-slate-950 border border-slate-700 rounded px-3 py-1.5 text-sm text-slate-300 font-mono truncate",children:H(n)||"This PC"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 min-h-[300px]",children:[u&&e.jsxs("div",{className:"flex items-center justify-center h-full text-slate-400 gap-2",children:[e.jsx(je,{className:"animate-spin",size:24}),"Loading..."]}),d&&e.jsxs("div",{className:"flex items-center justify-center h-full text-red-400 gap-2",children:[e.jsx(W,{size:24}),"Failed to load directory"]}),!u&&!d&&f.length===0&&e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 italic",children:"No items found"}),!u&&!d&&e.jsxs("div",{className:"space-y-1",children:[P.map(i=>e.jsxs("button",{onClick:()=>L(i.fullPath||i.name),className:"w-full flex items-center gap-3 p-2 hover:bg-slate-800 rounded text-left group",children:[e.jsx(ye,{className:"text-yellow-500 group-hover:text-yellow-400",size:20}),e.jsx("span",{className:"text-slate-200 text-sm flex-1 truncate",children:i.name})]},i.fullPath||i.name)),C.map(i=>e.jsxs("button",{onClick:()=>T(i),className:"w-full flex items-center gap-3 p-2 hover:bg-slate-800 rounded text-left group",children:[e.jsx(ie,{className:"text-blue-400 group-hover:text-blue-300",size:20}),e.jsx("span",{className:"text-slate-200 text-sm flex-1 truncate",children:i.name})]},i.fullPath||i.name))]})]}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-800 rounded-b-lg flex justify-end gap-2",children:e.jsx("button",{onClick:S,className:"px-4 py-2 rounded text-sm font-medium text-slate-300 hover:bg-slate-700 transition-colors",children:"Cancel"})})]})})}const Re={colors:{background:{primary:"#030712",secondary:"#0f172a",tertiary:"#1e293b",panel:"rgba(15, 23, 42, 0.8)",modal:"#0f172a",submenu:"rgba(15, 23, 42, 0.5)"},text:{primary:"#ffffff",secondary:"#e2e8f0",tertiary:"#cbd5e1",muted:"#94a3b8"},border:{default:"rgba(148, 163, 184, 0.3)",hover:"rgba(148, 163, 184, 0.4)",active:"#38bdf8",muted:"rgba(148, 163, 184, 0.12)"},accent:{primary:"#38bdf8",hover:"#0ea5e9",active:"#2563eb"},state:{success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6"}},spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem"},borderRadius:{sm:"0.4rem",md:"0.5rem",lg:"0.75rem",full:"999px"},shadows:{sm:"0 15px 30px rgba(2, 6, 23, 0.35)",md:"0 20px 45px rgba(2, 6, 23, 0.45)",lg:"0 30px 60px rgba(2, 6, 23, 0.7)",xl:"0 40px 80px rgba(2, 6, 23, 0.9)"}};function De(){return Re}const Te=r.lazy(()=>ge(()=>import("./TerminalViewer-DLskG58q.js"),__vite__mapDeps([0,1,2,3,4,5]))),ze=()=>w("/api/settings/capture"),re=s=>{const v=new URL("/api/fs/raw",window.location.origin);return v.searchParams.set("path",s),v.toString()};function He(){const{t:s}=ue(),v=De(),[S,M]=r.useState("screenshots"),[n,y]=r.useState(null),[F,D]=r.useState(!1),[d,u]=r.useState(new Set),[f,P]=r.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},variant:"info"}),{data:C,mutate:L}=U("capture-settings",ze),T=C?.folder??"",[x,i]=r.useState({enableIntervalCapture:!1,intervalSeconds:60});r.useEffect(()=>{C&&i({enableIntervalCapture:C.enableIntervalCapture??!1,intervalSeconds:C.intervalSeconds??60})},[C]);const{data:p,isLoading:N,mutate:R}=U(T?["screenshots",T]:null,([,t])=>{const c=new URL("/api/fs",window.location.origin);return c.searchParams.set("path",t),w(c.toString())},{revalidateOnFocus:!1}),A=r.useMemo(()=>!p||!Array.isArray(p)?[]:p.filter(t=>t.name.toLowerCase().endsWith(".png")),[p]);r.useEffect(()=>()=>{n&&URL.revokeObjectURL(n.url)},[n]);const B=t=>{y({path:t.fullPath,url:re(t.fullPath)})},[O,q]=r.useState(null),l=async t=>{q(t),P({isOpen:!0,title:"Delete Screenshot",message:s("tools.screenshots.deleteConfirm",{name:t.name}),onConfirm:async()=>{if(O)try{const c=new URL("/api/fs",window.location.origin);c.searchParams.set("path",O.fullPath),await w(c.toString(),{method:"DELETE"}),n?.path===O.fullPath&&(URL.revokeObjectURL(n.url),y(null)),u(g=>{const I=new Set(g);return I.delete(O.fullPath),I}),await R?.(),k("Screenshot deleted successfully","success"),q(null),P(g=>({...g,isOpen:!1}))}catch(c){k(`Failed to delete screenshot: ${c instanceof Error?c.message:"Unknown error"}`,"error")}},variant:"danger"})},o=t=>{u(c=>{const g=new Set(c);return g.has(t)?g.delete(t):g.add(t),g})},m=()=>{u(new Set(A.map(t=>t.fullPath)))},z=()=>{u(new Set)},X=async()=>{if(d.size!==0)try{const t=Array.from(d),c=localStorage.getItem("weasel.csrf")||"local",g=localStorage.getItem("weasel.auth.token"),I={"Content-Type":"application/json","X-Weasel-Csrf":c};g&&(I["X-Weasel-Token"]=g);const _=await fetch("/api/fs/download/bulk",{method:"POST",headers:I,body:JSON.stringify({paths:t})});if(!_.ok)throw new Error(`HTTP ${_.status}: ${_.statusText}`);const xe=await _.blob(),Y=window.URL.createObjectURL(xe),V=document.createElement("a");V.href=Y,V.download=`screenshots_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(V),V.click(),document.body.removeChild(V),window.URL.revokeObjectURL(Y),u(new Set)}catch(t){k(`Failed to download screenshots: ${t instanceof Error?t.message:String(t)}`,"error")}},a=async()=>{if(d.size===0)return;const t=d.size;P({isOpen:!0,title:"Delete Screenshots",message:`Delete ${t} screenshot${t>1?"s":""}?`,onConfirm:async()=>{try{const c=Array.from(d);for(const g of c){const I=new URL("/api/fs",window.location.origin);I.searchParams.set("path",g),await w(I.toString(),{method:"DELETE"}),n?.path===g&&(URL.revokeObjectURL(n.url),y(null))}u(new Set),await R?.(),k(`Deleted ${t} screenshot${t>1?"s":""} successfully`,"success"),P(g=>({...g,isOpen:!1}))}catch(c){k(`Failed to delete screenshots: ${c instanceof Error?c.message:String(c)}`,"error"),P(g=>({...g,isOpen:!1}))}},variant:"danger"})},h=async()=>{await w("/api/system/screenshot",{method:"POST"}),await R?.()},j=async()=>{D(!0);try{await w("/api/settings/capture",{method:"PUT",body:JSON.stringify({folder:C?.folder||"",filenamePattern:C?.filenamePattern||"",enableIntervalCapture:x.enableIntervalCapture,intervalSeconds:x.intervalSeconds})}),await L(),k(s("tools.screenshots.saveSuccess"),"success")}catch(t){const c=t instanceof Error?t.message:String(t);k(s("tools.screenshots.saveFailure",{message:c}),"error")}finally{D(!1)}},b=[{key:"application-monitor",label:s("tools.tabs.appMonitor"),icon:e.jsx(ee,{size:16})},{key:"storage-monitor",label:"Storage Monitor",icon:e.jsx(ce,{size:16})},{key:"terminal",label:"Terminal",icon:e.jsx(G,{size:16})},{key:"vnc",label:"VNC",icon:e.jsx(ee,{size:16})},{key:"screenshots",label:s("tools.tabs.screenshots"),icon:e.jsx(ne,{size:16})}];return e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"submenu-container",children:b.map(({key:t,label:c,icon:g})=>e.jsxs("button",{onClick:()=>M(t),className:`submenu-tab ${S===t?"active":""}`,children:[g,c]},t))}),S==="screenshots"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"panel-title mb-0 flex items-center gap-2",children:[e.jsx(ke,{size:18})," ",s("tools.screenshots.timedTitle")]}),e.jsxs("button",{className:"btn-primary",onClick:j,disabled:F,children:[e.jsx(Q,{size:16})," ",s(F?"tools.screenshots.saving":"tools.screenshots.save")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"interval-enable",className:"checkbox",checked:x.enableIntervalCapture,onChange:t=>i({...x,enableIntervalCapture:t.target.checked})}),e.jsx("label",{htmlFor:"interval-enable",className:"text-sm text-slate-300",children:s("tools.screenshots.enableAuto")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-slate-400",children:s("tools.screenshots.intervalLabel")}),e.jsx("input",{type:"number",min:1,className:"input-text w-24",value:x.intervalSeconds,onChange:t=>i({...x,intervalSeconds:Math.max(1,Number(t.target.value))}),disabled:!x.enableIntervalCapture})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:s("tools.screenshots.intervalHint")})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:s("tools.screenshots.sectionTitle")}),e.jsxs("p",{className:"text-sm text-slate-400",children:[s("tools.screenshots.folderLabel"),": ",H(T)||s("tools.screenshots.folderMissing")]})]}),e.jsxs("div",{className:"flex gap-2",children:[A.length>0&&e.jsx("button",{className:"btn-outline text-xs",onClick:d.size===A.length?z:m,children:d.size===A.length?e.jsxs(e.Fragment,{children:[e.jsx(se,{size:14})," Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:14})," Select All"]})}),e.jsxs("button",{className:"btn-primary",onClick:h,children:[e.jsx(ne,{size:16})," ",s("tools.screenshots.takeScreenshot")]}),e.jsxs("button",{className:"btn-outline",onClick:()=>R(),children:[e.jsx(K,{size:16})," ",s("common.refresh")]})]})]}),N&&e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.screenshots.loading")}),!N&&T&&A.length===0&&e.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx(Se,{size:16}),s("tools.screenshots.empty")]}),!T&&e.jsx("p",{className:"text-sm text-red-400",children:s("tools.screenshots.configurePrompt")}),d.size>0&&e.jsx("div",{className:"panel bg-sky-900/20 border-sky-500/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-300",children:[d.size," screenshot",d.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-outline text-xs",onClick:z,children:"Clear"}),e.jsxs("button",{className:"btn-primary text-xs",onClick:X,children:[e.jsx(le,{size:14})," Download as ZIP"]}),e.jsxs("button",{className:"btn-outline text-xs text-red-400 hover:text-red-300",onClick:a,children:[e.jsx(J,{size:14})," Delete"]})]})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.isArray(A)&&A.map(t=>e.jsxs("div",{className:`screenshot-card ${d.has(t.fullPath)?"ring-2 ring-sky-500":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:re(t.fullPath),alt:t.name,className:"screenshot-thumb",onClick:()=>B(t)}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("button",{className:"icon-btn bg-slate-900/80 hover:bg-slate-800/80",onClick:c=>{c.stopPropagation(),o(t.fullPath)},title:d.has(t.fullPath)?"Deselect":"Select",children:d.has(t.fullPath)?e.jsx(oe,{size:16,className:"text-sky-400"}):e.jsx(se,{size:16})})})]}),e.jsxs("div",{className:"screenshot-meta",children:[e.jsxs("div",{children:[e.jsx("p",{className:"screenshot-name",children:t.name}),e.jsx("p",{className:"text-xs text-slate-400",children:Z(t.modifiedAt)})]}),e.jsxs("div",{className:"screenshot-actions",children:[e.jsx("button",{className:"icon-btn",onClick:()=>B(t),title:s("common.view"),children:e.jsx(he,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>pe(t.fullPath),title:s("common.download"),children:e.jsx(le,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>l(t),title:"Delete",children:e.jsx(J,{size:16})})]})]})]},t.fullPath))})]}),n&&e.jsx("div",{className:"modal-backdrop",onClick:()=>y(null),children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-[0.2em]",children:s("tools.screenshots.previewTitle")}),e.jsx("p",{className:"font-semibold text-white break-all",children:n.path})]}),e.jsx("button",{className:"btn-outline",onClick:()=>y(null),children:s("common.cancel")})]}),e.jsx("div",{className:"modal-body",children:e.jsx("img",{src:n.url,alt:"Screenshot preview",className:"w-full rounded-md border border-slate-800"})})]})})]}),S==="storage-monitor"&&e.jsx(Me,{t:s,theme:v}),S==="application-monitor"&&e.jsx(Ie,{t:s}),S==="terminal"&&e.jsx(Fe,{t:s}),S==="vnc"&&e.jsx(Le,{t:s}),e.jsx(fe,{isOpen:f.isOpen,title:f.title,message:f.message,onConfirm:f.onConfirm,onCancel:()=>P(t=>({...t,isOpen:!1})),variant:f.variant})]})}function Me({t:s,theme:v}){const[S,M]=r.useState(!1),[n,y]=r.useState(null),[F,D]=r.useState(null),{data:d,mutate:u}=U("disk-monitoring-config",()=>w("/api/disk-monitoring/config")),{data:f,mutate:P}=U("disk-monitoring-status",()=>w("/api/disk-monitoring/status"),{refreshInterval:3e4}),{data:C}=U("available-drives",()=>w("/api/disk-monitoring/drives")),{data:L}=U("disk-monitor-log-files",()=>{const a=new URL("/api/logs",window.location.origin);return a.searchParams.set("subfolder","DiskMonitor"),w(a.toString())},{refreshInterval:1e4}),T=r.useMemo(()=>!L||!L.files||L.files.length===0?null:L.files.sort((a,h)=>h.name.localeCompare(a.name))[0],[L]),{data:x,isLoading:i}=U(T?["disk-monitor-log",T.name]:null,([,a])=>{const h=new URL(`/api/logs/${encodeURIComponent(a)}`,window.location.origin);return h.searchParams.set("subfolder","DiskMonitor"),w(h.toString())},{refreshInterval:2e3,revalidateOnFocus:!1}),[p,N]=r.useState({enabled:!1,monitoredDrives:[],folderMonitors:[],notificationRecipients:[]});r.useEffect(()=>{d&&N(d)},[d]);const R=r.useCallback(a=>{if(Array.isArray(p.monitoredDrives))return p.monitoredDrives.find(h=>h.driveName===a)},[p.monitoredDrives]),A=r.useCallback((a,h)=>{N(j=>{const b=Array.isArray(j.monitoredDrives)?j.monitoredDrives:[],t=b.find(I=>I.driveName===a),c=t?{...t,...h}:{driveName:a,enabled:!0,checkIntervalMinutes:15,thresholdPercent:null,thresholdBytes:null,...h},g=b.filter(I=>I.driveName!==a);return{...j,monitoredDrives:[...g,c]}})},[]),B=r.useCallback(async()=>{M(!0);try{await w("/api/disk-monitoring/config",{method:"PUT",body:JSON.stringify(p)}),await u(),await P(),k(s("tools.disk.saveSuccess"),"success")}catch(a){console.error("Failed to save disk monitoring config:",a);const h=a instanceof Error?a.message:String(a);k(s("tools.disk.saveFailure",{message:h}),"error")}finally{M(!1)}},[p,u,P,s]),O=r.useCallback(()=>{const a=window.prompt(s("tools.disk.recipientPrompt"));if(a){const h=Array.isArray(p.notificationRecipients)?p.notificationRecipients:[];h.includes(a)||N(j=>({...j,notificationRecipients:[...h,a]}))}},[p.notificationRecipients,s]),q=r.useCallback(a=>{N(h=>{const j=Array.isArray(h.notificationRecipients)?h.notificationRecipients:[];return{...h,notificationRecipients:j.filter(b=>b!==a)}})},[]),l=C&&Array.isArray(C)?C.find(a=>a.name===n):void 0,o=n?R(n):void 0,m=f?.driveStatuses&&Array.isArray(f.driveStatuses)?f.driveStatuses.find(a=>a.driveName===n):void 0,z=f?.isRunning?s("tools.disk.statusActive"):s("tools.disk.statusInactive"),X=f?.lastCheck?Z(f.lastCheck):s("tools.disk.statusNever");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:s("tools.disk.title")}),e.jsxs("p",{className:"text-sm text-slate-400",children:[z," • ",s("tools.disk.lastCheck",{value:X})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"btn-outline",onClick:()=>P(),children:[e.jsx(K,{size:16})," ",s("common.refresh")]}),e.jsxs("button",{className:"btn-primary",onClick:B,disabled:S,children:[e.jsx(Q,{size:16})," ",s(S?"tools.disk.saving":"tools.disk.save")]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enableMonitoring",checked:p.enabled,onChange:a=>N(h=>({...h,enabled:a.target.checked})),className:"checkbox"}),e.jsx("label",{htmlFor:"enableMonitoring",className:"text-sm text-slate-300",children:s("tools.disk.enable")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:s("tools.disk.recipients")}),e.jsx("button",{className:"btn-outline text-xs",onClick:O,children:s("tools.disk.addRecipient")})]}),e.jsxs("div",{className:"space-y-1",children:[Array.isArray(p.notificationRecipients)&&p.notificationRecipients.map(a=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:a}),e.jsx("button",{className:"icon-btn",onClick:()=>q(a),children:"×"})]},a)),p.notificationRecipients.length===0&&e.jsx("p",{className:"text-xs text-slate-500",children:s("tools.disk.noRecipients")})]})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h4",{className:"panel-title",children:s("tools.disk.availableDrives")}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:C&&Array.isArray(C)&&C.map(a=>{const h=a.totalBytes-a.freeBytes,j=h/a.totalBytes*100,b=a.freeBytes/a.totalBytes*100,t=R(a.name),c=f?.driveStatuses&&Array.isArray(f.driveStatuses)?f.driveStatuses.find(_=>_.driveName===a.name):void 0,g=n===a.name,I=t?.enabled??!1;return e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-colors ${g?"border-sky-500 bg-slate-900/70":I?"border-slate-700 bg-slate-900/50":"border-slate-800 bg-slate-900/30"} ${c?.isBelowThreshold?"border-red-500/50":""}`,onClick:()=>y(g?null:a.name),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:18,className:I?"text-sky-400":"text-slate-500"}),e.jsx("span",{className:"font-semibold text-white",children:a.name}),c?.isBelowThreshold&&e.jsx(be,{size:16,className:"text-red-400"})]}),I&&e.jsx("span",{className:"text-xs text-sky-400 bg-sky-900/30 px-2 py-0.5 rounded",children:s("tools.disk.monitoredBadge")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:v.colors.border.muted},children:e.jsxs("div",{className:"h-full flex",children:[e.jsx("div",{style:{width:`${j}%`,backgroundColor:v.colors.accent.primary},title:s("tools.disk.usedTooltip",{value:$(h)})}),e.jsx("div",{style:{width:`${b}%`,backgroundColor:v.colors.text.muted},title:s("tools.disk.freeTooltip",{value:$(a.freeBytes)})})]})}),e.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("tools.disk.total")}),e.jsx("span",{className:"text-slate-300",children:$(a.totalBytes)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("tools.disk.used")}),e.jsxs("span",{className:"text-slate-300",children:[$(h)," (",j.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("tools.disk.free")}),e.jsxs("span",{className:"text-slate-300",children:[$(a.freeBytes)," (",b.toFixed(1),"%)"]})]})]})]})]},a.name)})})]}),n&&l&&e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h4",{className:"panel-title",children:s("tools.disk.configureDrive",{drive:n})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`monitor-${n}`,checked:o?.enabled??!1,onChange:a=>A(n,{enabled:a.target.checked}),className:"checkbox"}),e.jsx("label",{htmlFor:`monitor-${n}`,className:"text-sm text-slate-300",children:s("tools.disk.enableDrive")})]}),(o?.enabled??!1)&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.checkInterval")}),e.jsx("input",{type:"number",min:1,max:1440,className:"input-text",value:o?.checkIntervalMinutes??15,onChange:a=>A(n,{checkIntervalMinutes:Number(a.target.value)})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s("tools.disk.checkIntervalHint")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-2",children:s("tools.disk.thresholdTitle")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 mb-1",children:[e.jsx("input",{type:"radio",name:`threshold-type-${n}`,checked:o?.thresholdPercent!==null&&o?.thresholdPercent!==void 0,onChange:()=>A(n,{thresholdPercent:10,thresholdBytes:null}),className:"radio"}),s("tools.disk.thresholdPercent")]}),o?.thresholdPercent!==null&&o?.thresholdPercent!==void 0&&e.jsx("input",{type:"number",min:1,max:100,className:"input-text mt-1",value:o.thresholdPercent,onChange:a=>A(n,{thresholdPercent:Number(a.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 mb-1",children:[e.jsx("input",{type:"radio",name:`threshold-type-${n}`,checked:o?.thresholdBytes!==null&&o?.thresholdBytes!==void 0,onChange:()=>A(n,{thresholdBytes:1024*1024*1024,thresholdPercent:null}),className:"radio"}),s("tools.disk.thresholdBytes")]}),o?.thresholdBytes!==null&&o?.thresholdBytes!==void 0&&e.jsx("input",{type:"number",min:0,step:1,className:"input-text mt-1",value:Math.round(o.thresholdBytes/(1024*1024)),onChange:a=>A(n,{thresholdBytes:Number(a.target.value)*1024*1024})})]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:s("tools.disk.thresholdHint")})]}),m&&e.jsxs("div",{className:`p-3 rounded-lg border ${m.isBelowThreshold?"border-red-500/50 bg-red-900/20":"border-slate-800 bg-slate-900/30"}`,children:[e.jsx("p",{className:"text-sm font-semibold text-white mb-1",children:s("tools.disk.statusCardTitle")}),e.jsxs("p",{className:"text-xs text-slate-400",children:[$(m.freeBytes)," ",s("tools.disk.free")," (",m.freePercent.toFixed(1),"%)",m.isBelowThreshold&&e.jsxs("span",{className:"text-red-400 ml-2",children:["⚠ ",s("tools.disk.belowThreshold")]})]}),m.lastAlertSent&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s("tools.disk.lastAlert",{value:Z(m.lastAlertSent)})})]})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"panel-title",children:s("tools.disk.folderMonitoring")}),e.jsx("button",{className:"btn-outline text-xs",onClick:()=>{N(a=>({...a,folderMonitors:[...a.folderMonitors,{path:"",enabled:!0,checkIntervalMinutes:15,thresholdBytes:1024*1024*1024,thresholdDirection:"Over"}]}))},children:s("tools.disk.addFolder")})]}),p.folderMonitors.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.disk.noFolders")}):e.jsx("div",{className:"space-y-3",children:Array.isArray(p.folderMonitors)&&p.folderMonitors.map((a,h)=>e.jsxs("div",{className:"p-4 border border-slate-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.enabled,onChange:j=>{N(b=>({...b,folderMonitors:Array.isArray(b.folderMonitors)?b.folderMonitors.map((t,c)=>c===h?{...t,enabled:j.target.checked}:t):[]}))},className:"checkbox"}),e.jsx("label",{className:"text-sm text-slate-300",children:s("tools.disk.enableFolder")}),e.jsx("button",{className:"ml-auto icon-btn text-red-400",onClick:()=>{N(j=>({...j,folderMonitors:Array.isArray(j.folderMonitors)?j.folderMonitors.filter((b,t)=>t!==h):[]}))},children:e.jsx(J,{size:14})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.folderPath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input-text flex-1",value:H(a.path),onChange:j=>{const b=j.target.value.replace(/\\\\/g,"\\");N(t=>({...t,folderMonitors:Array.isArray(t.folderMonitors)?t.folderMonitors.map((c,g)=>g===h?{...c,path:b}:c):[]}))},placeholder:s("tools.disk.folderPlaceholder")}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>D(h),children:e.jsx(me,{size:16})})]}),F===h&&e.jsx(ve,{initialPath:a.path,onSelect:j=>{const b=j.replace(/\\\\/g,"\\");N(t=>({...t,folderMonitors:Array.isArray(t.folderMonitors)?t.folderMonitors.map((c,g)=>g===h?{...c,path:b}:c):[]})),D(null)},onCancel:()=>D(null)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.checkInterval")}),e.jsx("input",{type:"number",min:1,max:1440,className:"input-text",value:a.checkIntervalMinutes,onChange:j=>{N(b=>({...b,folderMonitors:Array.isArray(b.folderMonitors)?b.folderMonitors.map((t,c)=>c===h?{...t,checkIntervalMinutes:Number(j.target.value)}:t):[]}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.thresholdDirection")}),e.jsxs("select",{className:"input-text",value:a.thresholdDirection||"Over",onChange:j=>{N(b=>({...b,folderMonitors:Array.isArray(b.folderMonitors)?b.folderMonitors.map((t,c)=>c===h?{...t,thresholdDirection:j.target.value}:t):[]}))},children:[e.jsx("option",{value:"Over",children:s("tools.disk.thresholdOver")}),e.jsx("option",{value:"Under",children:s("tools.disk.thresholdUnder")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.thresholdValue")}),e.jsx("input",{type:"number",min:0,step:1,className:"input-text",value:Math.round(a.thresholdBytes/(1024*1024)),onChange:j=>{N(b=>({...b,folderMonitors:Array.isArray(b.folderMonitors)?b.folderMonitors.map((t,c)=>c===h?{...t,thresholdBytes:Number(j.target.value)*1024*1024}:t):[]}))}})]}),e.jsx("p",{className:"text-xs text-slate-500",children:a.thresholdDirection==="Under"?s("tools.disk.thresholdSummaryUnder",{value:$(a.thresholdBytes)}):s("tools.disk.thresholdSummaryOver",{value:$(a.thresholdBytes)})})]},h))})]}),e.jsxs("div",{className:"panel space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"panel-title mb-0",children:s("tools.disk.logTitle","Storage Monitor Log")}),e.jsx("div",{className:"text-xs text-slate-400",children:i?"Loading...":"Tailing log (auto-refreshing every 2 seconds)"})]}),e.jsxs("div",{className:"bg-slate-950 rounded border border-slate-800 p-3 max-h-96 overflow-y-auto",children:[i&&e.jsx("p",{className:"text-sm text-slate-400",children:"Loading log..."}),!i&&!x&&e.jsx("p",{className:"text-sm text-slate-400",children:"No log content available"}),!i&&x&&e.jsx("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap font-mono",children:x})]})]})]})}function Ie({t:s}){const[v,S]=r.useState(!1),[M,n]=r.useState(!1),[y,F]=r.useState(null),[D,d]=r.useState(new Set),{data:u,mutate:f}=U("application-monitor-config",()=>w("/api/application-monitor/config")),{data:P}=U("application-monitor-log-files",()=>{const l=new URL("/api/logs",window.location.origin);return l.searchParams.set("subfolder","ApplicationMonitor"),w(l.toString())},{refreshInterval:1e4}),C=r.useMemo(()=>!P?.files||P.files.length===0?null:P.files.sort((l,o)=>o.name.localeCompare(l.name))[0],[P]),{data:L,isLoading:T}=U(C?["application-monitor-log",C.name]:null,([,l])=>{const o=new URL(`/api/logs/${encodeURIComponent(l)}`,window.location.origin);return o.searchParams.set("subfolder","ApplicationMonitor"),w(o.toString())},{revalidateOnFocus:!0,refreshInterval:2e3}),[x,i]=r.useState({enabled:!1,applications:[],notificationRecipients:[]});r.useEffect(()=>{u&&i({...u,notificationRecipients:Array.isArray(u.notificationRecipients)?u.notificationRecipients:[]})},[u]);const p=r.useCallback(async()=>{S(!0);try{await w("/api/application-monitor/config",{method:"PUT",body:JSON.stringify(x)}),await f(),k(s("tools.app.saveSuccess"),"success")}catch(l){console.error("Failed to save application monitor config:",l);const o=l instanceof Error?l.message:String(l);k(s("tools.app.saveFailure",{message:o}),"error")}finally{S(!1)}},[x,f,s]),N=r.useCallback(()=>{i(l=>({...l,applications:[...l.applications,{id:crypto.randomUUID(),name:"",executablePath:"",arguments:null,workingDirectory:null,enabled:!0,checkIntervalSeconds:60,restartDelaySeconds:5,logPath:null,eventLogSource:null}]}))},[]),R=r.useCallback((l,o)=>{i(m=>({...m,applications:Array.isArray(m.applications)?m.applications.map(z=>z.id===l?{...z,...o}:z):[]}))},[]),A=r.useCallback(l=>{if(y){const o=l.replace(/\\\\/g,"\\");R(y,{executablePath:o})}n(!1),F(null)},[y,R]),B=r.useCallback(l=>{i(o=>({...o,applications:Array.isArray(o.applications)?o.applications.filter(m=>m.id!==l):[]}))},[]),O=r.useCallback(()=>{const l=window.prompt(s("tools.app.recipientPrompt"));l&&i(o=>{const m=Array.isArray(o.notificationRecipients)?o.notificationRecipients:[];return m.includes(l)?o:{...o,notificationRecipients:[...m,l]}})},[s]),q=r.useCallback(l=>{i(o=>({...o,notificationRecipients:Array.isArray(o.notificationRecipients)?o.notificationRecipients.filter(m=>m!==l):[]}))},[]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:s("tools.app.title")}),e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.app.subtitle")})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{className:"btn-primary",onClick:p,disabled:v,children:[e.jsx(Q,{size:16})," ",s(v?"tools.app.saving":"tools.app.save")]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enableAppMonitoring",checked:x.enabled,onChange:l=>i(o=>({...o,enabled:l.target.checked})),className:"checkbox"}),e.jsx("label",{htmlFor:"enableAppMonitoring",className:"text-sm text-slate-300",children:s("tools.app.enable")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:s("tools.app.recipients")}),e.jsx("button",{className:"btn-outline text-xs",onClick:O,children:s("tools.app.addRecipient")})]}),e.jsxs("div",{className:"space-y-1",children:[Array.isArray(x.notificationRecipients)&&x.notificationRecipients.map(l=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:l}),e.jsx("button",{className:"icon-btn",onClick:()=>q(l),children:"×"})]},l)),(!x.notificationRecipients||x.notificationRecipients.length===0)&&e.jsx("p",{className:"text-xs text-slate-500",children:s("tools.app.noRecipients")})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:s("tools.app.listTitle")}),e.jsx("button",{className:"btn-outline text-xs",onClick:N,children:s("tools.app.addApplication")})]}),x.applications.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.app.empty")}):e.jsx("div",{className:"space-y-2",children:Array.isArray(x.applications)&&x.applications.map(l=>{const o=D.has(l.id);return e.jsxs("div",{className:"border border-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-900/30 hover:bg-slate-900/50",children:[e.jsx("input",{type:"checkbox",checked:l.enabled,onChange:m=>R(l.id,{enabled:m.target.checked}),className:"checkbox",onClick:m=>m.stopPropagation()}),e.jsx("span",{className:"flex-1 text-sm font-medium text-slate-200 min-w-0 truncate",children:l.name||s("tools.app.namePlaceholder")}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s("tools.app.checkInterval"),": ",l.checkIntervalSeconds,"s"]}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s("tools.app.restartDelay"),": ",l.restartDelaySeconds,"s"]}),e.jsx("button",{className:"icon-btn text-slate-400 hover:text-white",onClick:()=>{d(m=>{const z=new Set(m);return z.has(l.id)?z.delete(l.id):z.add(l.id),z})},title:o?"Collapse":"Expand",children:o?e.jsx(de,{size:16}):e.jsx(Ne,{size:16})}),e.jsx("button",{className:"icon-btn text-red-400 hover:text-red-300",onClick:()=>B(l.id),title:"Delete",children:e.jsx(J,{size:14})})]}),o&&e.jsxs("div",{className:"p-4 space-y-3 border-t border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.namePlaceholder")}),e.jsx("input",{type:"text",className:"input-text w-full",placeholder:s("tools.app.namePlaceholder"),value:l.name,onChange:m=>R(l.id,{name:m.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.executablePath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input-text flex-1",placeholder:s("tools.app.executablePlaceholder"),value:H(l.executablePath||""),onChange:m=>{const z=m.target.value.replace(/\\\\/g,"\\");R(l.id,{executablePath:z})}}),e.jsx("button",{className:"btn-outline",onClick:()=>{F(l.id),n(!0)},children:e.jsx(me,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.checkInterval")}),e.jsx("input",{type:"number",min:1,max:3600,className:"input-text",value:l.checkIntervalSeconds,onChange:m=>R(l.id,{checkIntervalSeconds:Number(m.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.restartDelay")}),e.jsx("input",{type:"number",min:0,max:300,className:"input-text",value:l.restartDelaySeconds,onChange:m=>R(l.id,{restartDelaySeconds:Number(m.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.arguments")}),e.jsx("input",{type:"text",className:"input-text",placeholder:s("tools.app.argumentsPlaceholder"),value:l.arguments||"",onChange:m=>R(l.id,{arguments:m.target.value||null})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.workingDirectory")}),e.jsx("input",{type:"text",className:"input-text",placeholder:s("tools.app.workingPlaceholder"),value:H(l.workingDirectory||""),onChange:m=>{const z=m.target.value.replace(/\\\\/g,"\\");R(l.id,{workingDirectory:z||null})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.eventLogSource")}),e.jsx("input",{type:"text",className:"input-text w-full",placeholder:s("tools.app.eventLogPlaceholder"),value:l.eventLogSource||"",onChange:m=>R(l.id,{eventLogSource:m.target.value||null})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s("tools.app.eventLogHint")})]})]})]},l.id)})})]})]})]}),e.jsxs("div",{className:"panel space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Application Monitor Log"}),e.jsx("div",{className:"text-xs text-slate-400",children:T?"Loading...":"Tailing log (auto-refreshing every 2 seconds)"})]}),e.jsxs("div",{className:"bg-slate-950 rounded border border-slate-800 p-3 max-h-96 overflow-y-auto",children:[T&&e.jsx("p",{className:"text-sm text-slate-400",children:"Loading log..."}),!T&&!L&&e.jsx("p",{className:"text-sm text-slate-400",children:"No log content available"}),!T&&L&&e.jsx("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap font-mono",children:L})]})]}),M&&e.jsx(Ae,{initialPath:y&&(x.applications||[]).find(l=>l.id===y)?.executablePath||"",onSelect:A,onCancel:()=>{n(!1),F(null)},fileExtensions:[".exe",".bat",".cmd",".com",".scr",".vbs",".js",".ps1"]})]})}function Fe({t:s}){const[v,S]=r.useState(null),[M,n]=r.useState(!1),[y,F]=r.useState(!1),D=async u=>{F(!0),n(!1);try{if(v)try{await ae(v.id)}catch{}const f=await te(u);S(f),k(`Terminal created (${u})`,"success")}catch(f){k(`Failed to create terminal: ${f instanceof Error?f.message:"Unknown error"}`,"error")}finally{F(!1)}},d=async()=>{if(v)try{await ae(v.id),S(null),k("Terminal closed","success")}catch(u){k(`Failed to close terminal: ${u instanceof Error?u.message:"Unknown error"}`,"error")}};return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Terminal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn-outline",onClick:async()=>{try{const f=`/terminal-popup?id=${(await te(v.shellType)).id}`;window.open(f,"_blank","width=800,height=600")}catch(u){k(`Failed to open popup: ${u instanceof Error?u.message:"Unknown error"}`,"error")}},title:"Open terminal in a new window",children:[e.jsx(we,{size:16})," Open in Popup"]}),e.jsxs("button",{className:"btn-outline",onClick:d,children:[e.jsx(W,{size:16})," Close Terminal"]})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>n(!0),disabled:y,children:[e.jsx(G,{size:16})," New Terminal"]})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Select Shell"}),e.jsx("button",{className:"text-slate-400 hover:text-white",onClick:()=>n(!1),children:e.jsx(W,{size:20})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full p-4 bg-slate-900/50 hover:bg-slate-900 border border-slate-700 rounded-lg text-left transition-colors",onClick:()=>D("cmd"),children:[e.jsx("div",{className:"font-medium text-white",children:"Command Prompt (cmd.exe)"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Windows Command Prompt"})]}),e.jsxs("button",{className:"w-full p-4 bg-slate-900/50 hover:bg-slate-900 border border-slate-700 rounded-lg text-left transition-colors",onClick:()=>D("powershell"),children:[e.jsx("div",{className:"font-medium text-white",children:"PowerShell"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Windows PowerShell"})]})]})]})}),v?e.jsx("div",{className:"h-[600px]",children:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full bg-slate-900 rounded-lg border border-slate-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-sky-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Loading terminal..."})]})}),children:e.jsx(Te,{sessionId:v.id,onClose:d})})}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(G,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"No active terminal"}),e.jsx("p",{className:"text-sm",children:'Click "New Terminal" to create one'})]})]})})}function Le({t:s}){const[v,S]=r.useState(!1),[M,n]=r.useState(!1),[y,F]=r.useState(""),{data:D}=U("vnc-config",()=>w("/api/vnc/config")),{data:d,mutate:u}=U("vnc-status",()=>w("/api/vnc/status"),{refreshInterval:2e3,revalidateOnFocus:!0,revalidateOnReconnect:!0});r.useEffect(()=>{u()},[u]);const f=async()=>{S(!0);try{await w("/api/vnc/start",{method:"POST"}),await u(),k(s("tools.vnc.startSuccess"),"success")}catch(x){k(s("tools.vnc.startFailure",{message:x instanceof Error?x.message:String(x)}),"error")}finally{S(!1)}},P=async()=>{n(!0);try{await w("/api/vnc/stop",{method:"POST"}),await u(),k(s("tools.vnc.stopSuccess"),"success")}catch(x){k(s("tools.vnc.stopFailure",{message:x instanceof Error?x.message:String(x)}),"error")}finally{n(!1)}},C=()=>{if(!d||!D)return;const x=d.allowRemote?window.location.hostname:"127.0.0.1",i=d.port;let p=y;if(D.hasPassword&&!p){const A=prompt("VNC server requires a password. Please enter the password:");if(!A){k("Password is required to connect to the VNC server.","error");return}p=A,F(A)}localStorage.setItem("vnc_host",x),localStorage.setItem("vnc_port",i.toString()),p?localStorage.setItem("vnc_password",p):localStorage.removeItem("vnc_password");const N=`/vnc-viewer?host=${encodeURIComponent(x)}&port=${i}${p?`&password=${encodeURIComponent(p)}`:""}`;window.open(N,"VNC Viewer",`width=${screen.width},height=${screen.height},fullscreen=yes,resizable=yes,scrollbars=no`)||k("Popup blocked. Please allow popups for this site to connect to VNC.","error")};if(!D)return e.jsx("div",{className:"text-sm text-slate-400",children:s("tools.vnc.loading")});const L=d?.allowRemote?window.location.hostname:"127.0.0.1",T=d?.isRunning?`${L}:${d.port}`:null;return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h3",{className:"panel-title mb-0",children:s("tools.vnc.statusTitle")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:s("tools.vnc.status")}),e.jsx("span",{className:`text-sm font-semibold ${d?.isRunning?"text-green-400":"text-slate-400"}`,children:d?.isRunning?s("tools.vnc.running"):s("tools.vnc.stopped")})]}),d?.isRunning&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:s("tools.vnc.connections")}),e.jsx("span",{className:"text-sm font-semibold text-white",children:d.connectionCount})]}),T&&e.jsxs("div",{className:"bg-slate-900/60 rounded-lg p-3 border border-slate-800",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:s("tools.vnc.connectionInfo")}),e.jsx("p",{className:"text-sm font-mono text-white",children:T}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:s("tools.vnc.connectionHint")})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[d?.isRunning?e.jsxs("button",{className:"btn-primary flex-1",onClick:C,disabled:!d.isRunning,children:[e.jsx(he,{size:16})," Connect"]}):e.jsx("button",{className:"btn-primary flex-1",onClick:f,disabled:v||M||!D.enabled,children:v?s("tools.vnc.starting"):"Start Server"}),e.jsx("button",{className:"btn-outline flex-1",onClick:P,disabled:v||M||!d?.isRunning,children:s(M?"tools.vnc.stopping":"tools.vnc.stop")}),e.jsx("button",{className:"btn-outline",onClick:()=>u(),children:e.jsx(K,{size:16})})]})]})]})})}export{He as default};
