const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-vnc-BgsbSd6u.js","assets/vendor-terminal-Co9mG8Of.js","assets/vendor-terminal-C0BCwPpi.css"])))=>i.map(i=>d[i]);
import{r as d,j as c,_ as C}from"./index-Ce5nNHDR.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";let h;function y({host:a,port:g,password:r,onDisconnect:i}){const u=d.useRef(null),l=d.useRef(null),[f,m]=d.useState(!1),[p,n]=d.useState("Connecting...");d.useEffect(()=>{if(!u.current)return;const V=u.current,N=window.location.protocol==="https:"?"wss:":"ws:",x=window.location.host,w=`${N}//${x}/api/vnc/ws?host=${encodeURIComponent(a)}&port=${g}`;return(async()=>{try{let o;try{o=await C(()=>import("./vendor-vnc-BgsbSd6u.js").then(e=>e.r),__vite__mapDeps([0,1,2])),h=o.default||o.RFB||o}catch{try{o=await C(()=>import("./vendor-vnc-BgsbSd6u.js").then(s=>s.r),__vite__mapDeps([0,1,2])),h=o.default||o.RFB||o}catch(s){console.error("Failed to import noVNC:",s),n("Failed to load VNC client library");return}}if(!h){n("VNC client library not available");return}console.log("Creating RFB client with WebSocket URL:",w),console.log("Password provided:",r?`yes (length: ${r.length})`:"no");const t=new h(V,w);r?(t.credentials={password:r},console.log("VNC credentials set as property")):console.log("No password provided for VNC connection"),t.addEventListener("connect",()=>{m(!0),n("Connected"),console.log("VNC connected successfully")}),t.addEventListener("desktopname",e=>{console.log("VNC desktop name:",e.detail?.name)}),t.addEventListener("disconnect",e=>{m(!1);const s=e.detail?.reason||e.detail?.message||"Unknown reason";n(`Disconnected: ${e.detail?.clean?"Clean disconnect":s}`),console.error("VNC disconnected",e.detail,e),i?.()}),t.addEventListener("credentialsrequired",e=>{if(console.log("VNC credentials required event fired",e),n("Sending credentials..."),r){t.credentials={password:r},console.log("VNC credentials set in credentialsrequired handler");try{if(typeof t.sendCredentials=="function"){t.sendCredentials({password:r}),console.log("Called sendCredentials method");return}if(typeof t.sendPassword=="function"){t.sendPassword(r),console.log("Called sendPassword method");return}console.log("Credentials property set - noVNC should use them automatically")}catch(s){console.error("Error in credentialsrequired handler:",s),n("Error sending credentials")}}else n("Password required but not provided"),console.error("VNC requires password but none was provided")}),t.addEventListener("securityfailure",e=>{const s=e.detail?.reason||e.detail?.message||"Authentication failed";n(`Security failure: ${s}`),console.error("VNC security failure",e.detail,e)}),t.addEventListener("error",e=>{const s=e.detail?.message||e.detail?.reason||"Connection error";n(`Error: ${s}`),console.error("VNC error",e.detail,e)}),t.scaleViewport=!1,t.resizeSession=!1,t.clipViewport=!1,l.current=t}catch(o){console.error("Failed to create VNC connection",o),n(`Connection error: ${o instanceof Error?o.message:"Unknown error"}`)}})(),()=>{l.current&&(l.current.disconnect(),l.current=null)}},[a,g,r,i]);const v=()=>{l.current&&l.current.disconnect(),i?.()};return c.jsxs("div",{className:"relative w-full h-full bg-black",children:[c.jsxs("div",{className:"absolute top-0 left-0 right-0 bg-slate-900/90 text-white p-2 flex items-center justify-between z-10",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${f?"bg-green-500":"bg-red-500"}`}),c.jsx("span",{className:"text-sm",children:p})]}),c.jsx("button",{onClick:v,className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm",children:"Disconnect"})]}),c.jsx("div",{ref:u,className:"w-full h-full",style:{display:"block",width:"100%",height:"100%",overflow:"auto"}})]})}function R(){const[a,g]=d.useState(null);d.useEffect(()=>{const i=new URLSearchParams(window.location.search),u=i.get("host")||localStorage.getItem("vnc_host")||"localhost",l=parseInt(i.get("port")||localStorage.getItem("vnc_port")||"5900",10),f=i.get("password"),m=f?decodeURIComponent(f):localStorage.getItem("vnc_password")||void 0;console.log("VncViewerPage: Extracted connection params",{host:u,port:l,passwordProvided:!!m,passwordLength:m?.length||0,passwordFromUrl:!!f,passwordFromStorage:!f&&!!localStorage.getItem("vnc_password")}),g({host:u,port:l,password:m}),setTimeout(async()=>{try{document.documentElement.requestFullscreen&&await document.documentElement.requestFullscreen()}catch(n){console.log("Could not enter fullscreen:",n)}},100)},[]);const r=()=>{document.fullscreenElement&&document.exitFullscreen(),setTimeout(()=>{window.close()},500)};return a?c.jsx("div",{className:"w-screen h-screen bg-black overflow-hidden",children:c.jsx(y,{host:a.host,port:a.port,password:a.password,onDisconnect:r})}):c.jsx("div",{className:"w-screen h-screen bg-black flex items-center justify-center text-white",children:c.jsx("div",{children:"Loading VNC connection..."})})}export{R as default};
