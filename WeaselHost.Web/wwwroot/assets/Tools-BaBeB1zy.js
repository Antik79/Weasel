const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TerminalViewer-D6D1Mw-T.js","assets/index-DO9zxgcv.js","assets/vendor-terminal-Co9mG8Of.js","assets/vendor-terminal-C0BCwPpi.css","assets/vendor-utils-BeCPKUKe.js","assets/index-ChWdfY49.css"])))=>i.map(i=>d[i]);
import{c as V,r,a as $,b as R,j as e,X as J,i as q,u as pe,M as se,H as de,k as te,R as Q,f as G,g as fe,C as be,s as P,l as je,e as B,m as ae,n as le,_ as ge}from"./index-DO9zxgcv.js";import{C as xe,L as ve,S as Y,F as me,a as ye}from"./FolderPicker-CLZjAXKz.js";import{F as Ne}from"./folder-C6nDsPry.js";import{L as W,C as ke}from"./LogPanel-Cs0XWVfY.js";import{D as ne}from"./download-BAhVRRd1.js";import{T as X}from"./trash-2-CbcpzXyx.js";import{E as he}from"./eye-DlR3Mca3.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=V("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=V("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=V("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=V("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=V("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=V("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=V("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),Pe=s=>R(`/api/fs?path=${encodeURIComponent(s)}`),Ae=()=>R("/api/fs/drives");function Te({initialPath:s,onSelect:b,onCancel:k,fileExtensions:z}){const[n,C]=r.useState(()=>{if(s){const i=s.lastIndexOf("\\");if(i>0)return s.substring(0,i)}return""}),I=n||"drives",{data:D,error:d,isLoading:x}=$(I,n?()=>Pe(n):Ae),u=D?.filter(i=>{if(i.isDirectory||!z||z.length===0)return!0;const T=i.name.substring(i.name.lastIndexOf(".")).toLowerCase();return z.some(L=>L.toLowerCase()===T)})||[],v=u.filter(i=>i.isDirectory),y=u.filter(i=>!i.isDirectory),S=i=>{C(i)},N=i=>{b(i.fullPath)},m=()=>{if(!n)return;const i=n.split(/[/\\]/);if(i.pop(),i.length===0||i.length===1&&i[0]==="")C("");else{const T=i.join("\\")||"";n.endsWith(":\\")||n.length===2&&n[1]===":"?C(""):C(T)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between bg-slate-800 rounded-t-lg",children:[e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(oe,{className:"text-blue-400",size:20}),"Select File"]}),e.jsx("button",{onClick:k,className:"text-slate-400 hover:text-white",children:e.jsx(J,{size:20})})]}),e.jsxs("div",{className:"p-2 bg-slate-800 border-b border-slate-700 flex gap-2 items-center",children:[e.jsx("button",{onClick:m,disabled:!n,className:"p-2 hover:bg-slate-700 rounded text-slate-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Go Up",children:e.jsx(xe,{size:20})}),e.jsx("div",{className:"flex-1 bg-slate-950 border border-slate-700 rounded px-3 py-1.5 text-sm text-slate-300 font-mono truncate",children:q(n)||"This PC"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 min-h-[300px]",children:[x&&e.jsxs("div",{className:"flex items-center justify-center h-full text-slate-400 gap-2",children:[e.jsx(ve,{className:"animate-spin",size:24}),"Loading..."]}),d&&e.jsxs("div",{className:"flex items-center justify-center h-full text-red-400 gap-2",children:[e.jsx(J,{size:24}),"Failed to load directory"]}),!x&&!d&&u.length===0&&e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 italic",children:"No items found"}),!x&&!d&&e.jsxs("div",{className:"space-y-1",children:[v.map(i=>e.jsxs("button",{onClick:()=>S(i.fullPath||i.name),className:"w-full flex items-center gap-3 p-2 hover:bg-slate-800 rounded text-left group",children:[e.jsx(Ne,{className:"text-yellow-500 group-hover:text-yellow-400",size:20}),e.jsx("span",{className:"text-slate-200 text-sm flex-1 truncate",children:i.name})]},i.fullPath||i.name)),y.map(i=>e.jsxs("button",{onClick:()=>N(i),className:"w-full flex items-center gap-3 p-2 hover:bg-slate-800 rounded text-left group",children:[e.jsx(oe,{className:"text-blue-400 group-hover:text-blue-300",size:20}),e.jsx("span",{className:"text-slate-200 text-sm flex-1 truncate",children:i.name})]},i.fullPath||i.name))]})]}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-800 rounded-b-lg flex justify-end gap-2",children:e.jsx("button",{onClick:k,className:"px-4 py-2 rounded text-sm font-medium text-slate-300 hover:bg-slate-700 transition-colors",children:"Cancel"})})]})})}const De={colors:{background:{primary:"#030712",secondary:"#0f172a",tertiary:"#1e293b",panel:"rgba(15, 23, 42, 0.8)",modal:"#0f172a",submenu:"rgba(15, 23, 42, 0.5)"},text:{primary:"#ffffff",secondary:"#e2e8f0",tertiary:"#cbd5e1",muted:"#94a3b8"},border:{default:"rgba(148, 163, 184, 0.3)",hover:"rgba(148, 163, 184, 0.4)",active:"#38bdf8",muted:"rgba(148, 163, 184, 0.12)"},accent:{primary:"#38bdf8",hover:"#0ea5e9",active:"#2563eb"},state:{success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6"}},spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem"},borderRadius:{sm:"0.4rem",md:"0.5rem",lg:"0.75rem",full:"999px"},shadows:{sm:"0 15px 30px rgba(2, 6, 23, 0.35)",md:"0 20px 45px rgba(2, 6, 23, 0.45)",lg:"0 30px 60px rgba(2, 6, 23, 0.7)",xl:"0 40px 80px rgba(2, 6, 23, 0.9)"}};function Re(){return De}const ze=r.lazy(()=>ge(()=>import("./TerminalViewer-D6D1Mw-T.js"),__vite__mapDeps([0,1,2,3,4,5]))),Me=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const b=Math.random()*16|0;return(s==="x"?b:b&3|8).toString(16)}),Ie=()=>R("/api/settings/capture"),ce=s=>{const b=new URL("/api/fs/raw",window.location.origin);return b.searchParams.set("path",s),b.toString()};function Ke(){const{t:s}=pe(),b=Re(),[k,z]=r.useState("screenshots"),[n,C]=r.useState(null),[I,D]=r.useState(!1),[d,x]=r.useState(new Set);r.useEffect(()=>{const l=()=>{const f=window.location.hash.slice(1);if(!f)return;const w=f.split("/").filter(Boolean);if(w[0]==="tools"&&w[1]){const F=w[1];["application-monitor","storage-monitor","terminal","vnc","screenshots"].includes(F)&&z(F)}};return l(),window.addEventListener("hashchange",l),()=>window.removeEventListener("hashchange",l)},[]),r.useEffect(()=>{const f=window.location.hash.slice(1).split("/").filter(Boolean);f[0]==="tools"&&f[1]!==k&&(window.location.hash=`/tools/${k}`)},[k]);const[u,v]=r.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},variant:"info"}),{data:y,mutate:S}=$("capture-settings",Ie),N=y?.folder??"",[m,i]=r.useState({enableIntervalCapture:!1,intervalSeconds:60});r.useEffect(()=>{y&&i({enableIntervalCapture:y.enableIntervalCapture??!1,intervalSeconds:y.intervalSeconds??60})},[y]);const{data:T,isLoading:L,mutate:E}=$(N?["screenshots",N]:null,([,l])=>{const f=new URL("/api/fs",window.location.origin);return f.searchParams.set("path",l),R(f.toString())},{revalidateOnFocus:!1}),t=r.useMemo(()=>!T||!Array.isArray(T)?[]:T.filter(l=>l.name.toLowerCase().endsWith(".png")),[T]);r.useEffect(()=>()=>{n&&URL.revokeObjectURL(n.url)},[n]);const o=l=>{C({path:l.fullPath,url:ce(l.fullPath)})},[c,M]=r.useState(null),Z=async l=>{M(l),v({isOpen:!0,title:"Delete Screenshot",message:s("tools.screenshots.deleteConfirm",{name:l.name}),onConfirm:async()=>{if(c)try{const f=new URL("/api/fs",window.location.origin);f.searchParams.set("path",c.fullPath),await R(f.toString(),{method:"DELETE"}),n?.path===c.fullPath&&(URL.revokeObjectURL(n.url),C(null)),x(w=>{const F=new Set(w);return F.delete(c.fullPath),F}),await E?.(),P("Screenshot deleted successfully","success"),M(null),v(w=>({...w,isOpen:!1}))}catch(f){P(`Failed to delete screenshot: ${f instanceof Error?f.message:"Unknown error"}`,"error")}},variant:"danger"})},a=l=>{x(f=>{const w=new Set(f);return w.has(l)?w.delete(l):w.add(l),w})},h=()=>{x(new Set(t.map(l=>l.fullPath)))},j=()=>{x(new Set)},p=async()=>{if(d.size!==0)try{const l=Array.from(d),f=localStorage.getItem("weasel.csrf")||"local",w=localStorage.getItem("weasel.auth.token"),F={"Content-Type":"application/json","X-Weasel-Csrf":f};w&&(F["X-Weasel-Token"]=w);const H=await fetch("/api/fs/download/bulk",{method:"POST",headers:F,body:JSON.stringify({paths:l})});if(!H.ok)throw new Error(`HTTP ${H.status}: ${H.statusText}`);const ue=await H.blob(),ee=window.URL.createObjectURL(ue),_=document.createElement("a");_.href=ee,_.download=`screenshots_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(ee),x(new Set)}catch(l){P(`Failed to download screenshots: ${l instanceof Error?l.message:String(l)}`,"error")}},g=async()=>{if(d.size===0)return;const l=d.size;v({isOpen:!0,title:"Delete Screenshots",message:`Delete ${l} screenshot${l>1?"s":""}?`,onConfirm:async()=>{try{const f=Array.from(d);for(const w of f){const F=new URL("/api/fs",window.location.origin);F.searchParams.set("path",w),await R(F.toString(),{method:"DELETE"}),n?.path===w&&(URL.revokeObjectURL(n.url),C(null))}x(new Set),await E?.(),P(`Deleted ${l} screenshot${l>1?"s":""} successfully`,"success"),v(w=>({...w,isOpen:!1}))}catch(f){P(`Failed to delete screenshots: ${f instanceof Error?f.message:String(f)}`,"error"),v(w=>({...w,isOpen:!1}))}},variant:"danger"})},A=async()=>{await R("/api/system/screenshot",{method:"POST"}),await E?.()},U=async()=>{D(!0);try{await R("/api/settings/capture",{method:"PUT",body:JSON.stringify({folder:y?.folder||"",filenamePattern:y?.filenamePattern||"",enableIntervalCapture:m.enableIntervalCapture,intervalSeconds:m.intervalSeconds})}),await S(),P(s("tools.screenshots.saveSuccess"),"success")}catch(l){const f=l instanceof Error?l.message:String(l);P(s("tools.screenshots.saveFailure",{message:f}),"error")}finally{D(!1)}},O=[{key:"application-monitor",label:s("tools.tabs.appMonitor"),icon:e.jsx(se,{size:16})},{key:"storage-monitor",label:"Storage Monitor",icon:e.jsx(de,{size:16})},{key:"terminal",label:"Terminal",icon:e.jsx(K,{size:16})},{key:"vnc",label:"VNC",icon:e.jsx(se,{size:16})},{key:"screenshots",label:s("tools.tabs.screenshots"),icon:e.jsx(ie,{size:16})}];return e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"submenu-container",children:O.map(({key:l,label:f,icon:w})=>e.jsxs("button",{onClick:()=>z(l),className:`submenu-tab ${k===l?"active":""}`,children:[w,f]},l))}),k==="screenshots"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"panel-title mb-0 flex items-center gap-2",children:[e.jsx(we,{size:18})," ",s("tools.screenshots.timedTitle")]}),e.jsxs("button",{className:"btn-primary",onClick:U,disabled:I,children:[e.jsx(Y,{size:16})," ",s(I?"tools.screenshots.saving":"tools.screenshots.save")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"interval-enable",className:"checkbox",checked:m.enableIntervalCapture,onChange:l=>i({...m,enableIntervalCapture:l.target.checked})}),e.jsx("label",{htmlFor:"interval-enable",className:"text-sm text-slate-300",children:s("tools.screenshots.enableAuto")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-slate-400",children:s("tools.screenshots.intervalLabel")}),e.jsx("input",{type:"number",min:1,className:"input-text w-24",value:m.intervalSeconds,onChange:l=>i({...m,intervalSeconds:Math.max(1,Number(l.target.value))}),disabled:!m.enableIntervalCapture})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:s("tools.screenshots.intervalHint")})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:s("tools.screenshots.sectionTitle")}),e.jsxs("p",{className:"text-sm text-slate-400",children:[s("tools.screenshots.folderLabel"),": ",q(N)||s("tools.screenshots.folderMissing")]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.length>0&&e.jsx("button",{className:"btn-outline text-xs",onClick:d.size===t.length?j:h,children:d.size===t.length?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:14})," Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{size:14})," Select All"]})}),e.jsxs("button",{className:"btn-primary",onClick:A,children:[e.jsx(ie,{size:16})," ",s("tools.screenshots.takeScreenshot")]}),e.jsxs("button",{className:"btn-outline",onClick:()=>E(),children:[e.jsx(Q,{size:16})," ",s("common.refresh")]})]})]}),L&&e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.screenshots.loading")}),!L&&N&&t.length===0&&e.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx(Ce,{size:16}),s("tools.screenshots.empty")]}),!N&&e.jsx("p",{className:"text-sm text-red-400",children:s("tools.screenshots.configurePrompt")}),d.size>0&&e.jsx("div",{className:"panel bg-sky-900/20 border-sky-500/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-300",children:[d.size," screenshot",d.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-outline text-xs",onClick:j,children:"Clear"}),e.jsxs("button",{className:"btn-primary text-xs",onClick:p,children:[e.jsx(ne,{size:14})," Download as ZIP"]}),e.jsxs("button",{className:"btn-outline text-xs text-red-400 hover:text-red-300",onClick:g,children:[e.jsx(X,{size:14})," Delete"]})]})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.isArray(t)&&t.map(l=>e.jsxs("div",{className:`screenshot-card ${d.has(l.fullPath)?"ring-2 ring-sky-500":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:ce(l.fullPath),alt:l.name,className:"screenshot-thumb",onClick:()=>o(l)}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("button",{className:"icon-btn bg-slate-900/80 hover:bg-slate-800/80",onClick:f=>{f.stopPropagation(),a(l.fullPath)},title:d.has(l.fullPath)?"Deselect":"Select",children:d.has(l.fullPath)?e.jsx(re,{size:16,className:"text-sky-400"}):e.jsx(te,{size:16})})})]}),e.jsxs("div",{className:"screenshot-meta",children:[e.jsxs("div",{children:[e.jsx("p",{className:"screenshot-name",children:l.name}),e.jsx("p",{className:"text-xs text-slate-400",children:G(l.modifiedAt)})]}),e.jsxs("div",{className:"screenshot-actions",children:[e.jsx("button",{className:"icon-btn",onClick:()=>o(l),title:s("common.view"),children:e.jsx(he,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>fe(l.fullPath),title:s("common.download"),children:e.jsx(ne,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>Z(l),title:"Delete",children:e.jsx(X,{size:16})})]})]})]},l.fullPath))})]}),n&&e.jsx("div",{className:"modal-backdrop",onClick:()=>C(null),children:e.jsxs("div",{className:"modal",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-[0.2em]",children:s("tools.screenshots.previewTitle")}),e.jsx("p",{className:"font-semibold text-white break-all",children:n.path})]}),e.jsx("button",{className:"btn-outline",onClick:()=>C(null),children:s("common.cancel")})]}),e.jsx("div",{className:"modal-body",children:e.jsx("img",{src:n.url,alt:"Screenshot preview",className:"w-full rounded-md border border-slate-800"})})]})}),e.jsx(Ee,{t:s})]}),k==="storage-monitor"&&e.jsx(Fe,{t:s,theme:b}),k==="application-monitor"&&e.jsx(Le,{t:s}),k==="terminal"&&e.jsx(Ue,{t:s}),k==="vnc"&&e.jsx(Be,{t:s}),e.jsx(be,{isOpen:u.isOpen,title:u.title,message:u.message,onConfirm:u.onConfirm,onCancel:()=>v(l=>({...l,isOpen:!1})),variant:u.variant})]})}function Fe({t:s,theme:b}){const[k,z]=r.useState(!1),[n,C]=r.useState(null),[I,D]=r.useState(null),{data:d,mutate:x}=$("disk-monitoring-config",()=>R("/api/disk-monitoring/config")),{data:u,mutate:v}=$("disk-monitoring-status",()=>R("/api/disk-monitoring/status"),{refreshInterval:3e4}),{data:y}=$("available-drives",()=>R("/api/disk-monitoring/drives")),[S,N]=r.useState({enabled:!1,monitoredDrives:[],folderMonitors:[],notificationRecipients:[]});r.useEffect(()=>{d&&N(d)},[d]);const m=r.useCallback(a=>{if(Array.isArray(S.monitoredDrives))return S.monitoredDrives.find(h=>h.driveName===a)},[S.monitoredDrives]),i=r.useCallback((a,h)=>{N(j=>{const p=Array.isArray(j.monitoredDrives)?j.monitoredDrives:[],g=p.find(O=>O.driveName===a),A=g?{...g,...h}:{driveName:a,enabled:!0,checkIntervalMinutes:15,thresholdPercent:null,thresholdBytes:null,...h},U=p.filter(O=>O.driveName!==a);return{...j,monitoredDrives:[...U,A]}})},[]),T=r.useCallback(async()=>{z(!0);try{await R("/api/disk-monitoring/config",{method:"PUT",body:JSON.stringify(S)}),await x(),await v(),P(s("tools.disk.saveSuccess"),"success")}catch(a){console.error("Failed to save disk monitoring config:",a);const h=a instanceof Error?a.message:String(a);P(s("tools.disk.saveFailure",{message:h}),"error")}finally{z(!1)}},[S,x,v,s]),L=r.useCallback(()=>{const a=window.prompt(s("tools.disk.recipientPrompt"));if(a){const h=Array.isArray(S.notificationRecipients)?S.notificationRecipients:[];h.includes(a)||N(j=>({...j,notificationRecipients:[...h,a]}))}},[S.notificationRecipients,s]),E=r.useCallback(a=>{N(h=>{const j=Array.isArray(h.notificationRecipients)?h.notificationRecipients:[];return{...h,notificationRecipients:j.filter(p=>p!==a)}})},[]),t=y&&Array.isArray(y)?y.find(a=>a.name===n):void 0,o=n?m(n):void 0,c=u?.driveStatuses&&Array.isArray(u.driveStatuses)?u.driveStatuses.find(a=>a.driveName===n):void 0,M=u?.isRunning?s("tools.disk.statusActive"):s("tools.disk.statusInactive"),Z=u?.lastCheck?G(u.lastCheck):s("tools.disk.statusNever");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:s("tools.disk.title")}),e.jsxs("p",{className:"text-sm text-slate-400",children:[M," • ",s("tools.disk.lastCheck",{value:Z})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"btn-outline",onClick:()=>v(),children:[e.jsx(Q,{size:16})," ",s("common.refresh")]}),e.jsxs("button",{className:"btn-primary",onClick:T,disabled:k,children:[e.jsx(Y,{size:16})," ",s(k?"tools.disk.saving":"tools.disk.save")]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enableMonitoring",checked:S.enabled,onChange:a=>N(h=>({...h,enabled:a.target.checked})),className:"checkbox"}),e.jsx("label",{htmlFor:"enableMonitoring",className:"text-sm text-slate-300",children:s("tools.disk.enable")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:s("tools.disk.recipients")}),e.jsx("button",{className:"btn-outline text-xs",onClick:L,children:s("tools.disk.addRecipient")})]}),e.jsxs("div",{className:"space-y-1",children:[Array.isArray(S.notificationRecipients)&&S.notificationRecipients.map(a=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:a}),e.jsx("button",{className:"icon-btn",onClick:()=>E(a),children:"×"})]},a)),S.notificationRecipients.length===0&&e.jsx("p",{className:"text-xs text-slate-500",children:s("tools.disk.noRecipients")})]})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h4",{className:"panel-title",children:s("tools.disk.availableDrives")}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:y&&Array.isArray(y)&&y.map(a=>{const h=a.totalBytes-a.freeBytes,j=h/a.totalBytes*100,p=a.freeBytes/a.totalBytes*100,g=m(a.name),A=u?.driveStatuses&&Array.isArray(u.driveStatuses)?u.driveStatuses.find(l=>l.driveName===a.name):void 0,U=n===a.name,O=g?.enabled??!1;return e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-colors ${U?"border-sky-500 bg-slate-900/70":O?"border-slate-700 bg-slate-900/50":"border-slate-800 bg-slate-900/30"} ${A?.isBelowThreshold?"border-red-500/50":""}`,onClick:()=>C(U?null:a.name),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{size:18,className:O?"text-sky-400":"text-slate-500"}),e.jsx("span",{className:"font-semibold text-white",children:a.name}),A?.isBelowThreshold&&e.jsx(je,{size:16,className:"text-red-400"})]}),O&&e.jsx("span",{className:"text-xs text-sky-400 bg-sky-900/30 px-2 py-0.5 rounded",children:s("tools.disk.monitoredBadge")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:b.colors.border.muted},children:e.jsxs("div",{className:"h-full flex",children:[e.jsx("div",{style:{width:`${j}%`,backgroundColor:b.colors.accent.primary},title:s("tools.disk.usedTooltip",{value:B(h)})}),e.jsx("div",{style:{width:`${p}%`,backgroundColor:b.colors.text.muted},title:s("tools.disk.freeTooltip",{value:B(a.freeBytes)})})]})}),e.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("tools.disk.total")}),e.jsx("span",{className:"text-slate-300",children:B(a.totalBytes)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("tools.disk.used")}),e.jsxs("span",{className:"text-slate-300",children:[B(h)," (",j.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("tools.disk.free")}),e.jsxs("span",{className:"text-slate-300",children:[B(a.freeBytes)," (",p.toFixed(1),"%)"]})]})]})]})]},a.name)})})]}),n&&t&&e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h4",{className:"panel-title",children:s("tools.disk.configureDrive",{drive:n})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`monitor-${n}`,checked:o?.enabled??!1,onChange:a=>i(n,{enabled:a.target.checked}),className:"checkbox"}),e.jsx("label",{htmlFor:`monitor-${n}`,className:"text-sm text-slate-300",children:s("tools.disk.enableDrive")})]}),(o?.enabled??!1)&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.checkInterval")}),e.jsx("input",{type:"number",min:1,max:1440,className:"input-text",value:o?.checkIntervalMinutes??15,onChange:a=>i(n,{checkIntervalMinutes:Number(a.target.value)})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s("tools.disk.checkIntervalHint")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-2",children:s("tools.disk.thresholdTitle")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 mb-1",children:[e.jsx("input",{type:"radio",name:`threshold-type-${n}`,checked:o?.thresholdPercent!==null&&o?.thresholdPercent!==void 0,onChange:()=>i(n,{thresholdPercent:10,thresholdBytes:null}),className:"radio"}),s("tools.disk.thresholdPercent")]}),o?.thresholdPercent!==null&&o?.thresholdPercent!==void 0&&e.jsx("input",{type:"number",min:1,max:100,className:"input-text mt-1",value:o.thresholdPercent,onChange:a=>i(n,{thresholdPercent:Number(a.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 mb-1",children:[e.jsx("input",{type:"radio",name:`threshold-type-${n}`,checked:o?.thresholdBytes!==null&&o?.thresholdBytes!==void 0,onChange:()=>i(n,{thresholdBytes:1024*1024*1024,thresholdPercent:null}),className:"radio"}),s("tools.disk.thresholdBytes")]}),o?.thresholdBytes!==null&&o?.thresholdBytes!==void 0&&e.jsx("input",{type:"number",min:0,step:1,className:"input-text mt-1",value:Math.round(o.thresholdBytes/(1024*1024)),onChange:a=>i(n,{thresholdBytes:Number(a.target.value)*1024*1024})})]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:s("tools.disk.thresholdHint")})]}),c&&e.jsxs("div",{className:`p-3 rounded-lg border ${c.isBelowThreshold?"border-red-500/50 bg-red-900/20":"border-slate-800 bg-slate-900/30"}`,children:[e.jsx("p",{className:"text-sm font-semibold text-white mb-1",children:s("tools.disk.statusCardTitle")}),e.jsxs("p",{className:"text-xs text-slate-400",children:[B(c.freeBytes)," ",s("tools.disk.free")," (",c.freePercent.toFixed(1),"%)",c.isBelowThreshold&&e.jsxs("span",{className:"text-red-400 ml-2",children:["⚠ ",s("tools.disk.belowThreshold")]})]}),c.lastAlertSent&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s("tools.disk.lastAlert",{value:G(c.lastAlertSent)})})]})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"panel-title",children:s("tools.disk.folderMonitoring")}),e.jsx("button",{className:"btn-outline text-xs",onClick:()=>{N(a=>({...a,folderMonitors:[...a.folderMonitors,{path:"",enabled:!0,checkIntervalMinutes:15,thresholdBytes:1024*1024*1024,thresholdDirection:"Over"}]}))},children:s("tools.disk.addFolder")})]}),S.folderMonitors.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.disk.noFolders")}):e.jsx("div",{className:"space-y-3",children:Array.isArray(S.folderMonitors)&&S.folderMonitors.map((a,h)=>e.jsxs("div",{className:"p-4 border border-slate-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.enabled,onChange:j=>{N(p=>({...p,folderMonitors:Array.isArray(p.folderMonitors)?p.folderMonitors.map((g,A)=>A===h?{...g,enabled:j.target.checked}:g):[]}))},className:"checkbox"}),e.jsx("label",{className:"text-sm text-slate-300",children:s("tools.disk.enableFolder")}),e.jsx("button",{className:"ml-auto icon-btn text-red-400",onClick:()=>{N(j=>({...j,folderMonitors:Array.isArray(j.folderMonitors)?j.folderMonitors.filter((p,g)=>g!==h):[]}))},children:e.jsx(X,{size:14})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.folderPath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input-text flex-1",value:q(a.path),onChange:j=>{const p=j.target.value.replace(/\\\\/g,"\\");N(g=>({...g,folderMonitors:Array.isArray(g.folderMonitors)?g.folderMonitors.map((A,U)=>U===h?{...A,path:p}:A):[]}))},placeholder:s("tools.disk.folderPlaceholder")}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>D(h),children:e.jsx(me,{size:16})})]}),I===h&&e.jsx(ye,{initialPath:a.path,onSelect:j=>{const p=j.replace(/\\\\/g,"\\");N(g=>({...g,folderMonitors:Array.isArray(g.folderMonitors)?g.folderMonitors.map((A,U)=>U===h?{...A,path:p}:A):[]})),D(null)},onCancel:()=>D(null)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.checkInterval")}),e.jsx("input",{type:"number",min:1,max:1440,className:"input-text",value:a.checkIntervalMinutes,onChange:j=>{N(p=>({...p,folderMonitors:Array.isArray(p.folderMonitors)?p.folderMonitors.map((g,A)=>A===h?{...g,checkIntervalMinutes:Number(j.target.value)}:g):[]}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.thresholdDirection")}),e.jsxs("select",{className:"input-text",value:a.thresholdDirection||"Over",onChange:j=>{N(p=>({...p,folderMonitors:Array.isArray(p.folderMonitors)?p.folderMonitors.map((g,A)=>A===h?{...g,thresholdDirection:j.target.value}:g):[]}))},children:[e.jsx("option",{value:"Over",children:s("tools.disk.thresholdOver")}),e.jsx("option",{value:"Under",children:s("tools.disk.thresholdUnder")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.disk.thresholdValue")}),e.jsx("input",{type:"number",min:0,step:1,className:"input-text",value:Math.round(a.thresholdBytes/(1024*1024)),onChange:j=>{N(p=>({...p,folderMonitors:Array.isArray(p.folderMonitors)?p.folderMonitors.map((g,A)=>A===h?{...g,thresholdBytes:Number(j.target.value)*1024*1024}:g):[]}))}})]}),e.jsx("p",{className:"text-xs text-slate-500",children:a.thresholdDirection==="Under"?s("tools.disk.thresholdSummaryUnder",{value:B(a.thresholdBytes)}):s("tools.disk.thresholdSummaryOver",{value:B(a.thresholdBytes)})})]},h))})]}),e.jsx(W,{name:"DiskMonitor",title:s("tools.disk.logTitle"),subfolder:"DiskMonitor"})]})}function Le({t:s}){const[b,k]=r.useState(!1),[z,n]=r.useState(!1),[C,I]=r.useState(null),[D,d]=r.useState(new Set),{data:x,mutate:u}=$("application-monitor-config",()=>R("/api/application-monitor/config")),[v,y]=r.useState({enabled:!1,applications:[],notificationRecipients:[]});r.useEffect(()=>{x&&y({...x,notificationRecipients:Array.isArray(x.notificationRecipients)?x.notificationRecipients:[]})},[x]);const S=r.useCallback(async()=>{k(!0);try{await R("/api/application-monitor/config",{method:"PUT",body:JSON.stringify(v)}),await u(),P(s("tools.app.saveSuccess"),"success")}catch(t){console.error("Failed to save application monitor config:",t);const o=t instanceof Error?t.message:String(t);P(s("tools.app.saveFailure",{message:o}),"error")}finally{k(!1)}},[v,u,s]),N=r.useCallback(()=>{const t=Me();y(o=>({...o,applications:[...o.applications,{id:t,name:"",executablePath:"",arguments:null,workingDirectory:null,enabled:!0,checkIntervalSeconds:60,restartDelaySeconds:5,logPath:null,eventLogSource:null}]})),d(o=>new Set([...o,t]))},[]),m=r.useCallback((t,o)=>{y(c=>({...c,applications:Array.isArray(c.applications)?c.applications.map(M=>M.id===t?{...M,...o}:M):[]}))},[]),i=r.useCallback(t=>{if(C){const o=t.replace(/\\\\/g,"\\");m(C,{executablePath:o})}n(!1),I(null)},[C,m]),T=r.useCallback(t=>{y(o=>({...o,applications:Array.isArray(o.applications)?o.applications.filter(c=>c.id!==t):[]}))},[]),L=r.useCallback(()=>{const t=window.prompt(s("tools.app.recipientPrompt"));t&&y(o=>{const c=Array.isArray(o.notificationRecipients)?o.notificationRecipients:[];return c.includes(t)?o:{...o,notificationRecipients:[...c,t]}})},[s]),E=r.useCallback(t=>{y(o=>({...o,notificationRecipients:Array.isArray(o.notificationRecipients)?o.notificationRecipients.filter(c=>c!==t):[]}))},[]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:s("tools.app.title")}),e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.app.subtitle")})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{className:"btn-primary",onClick:S,disabled:b,children:[e.jsx(Y,{size:16})," ",s(b?"tools.app.saving":"tools.app.save")]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enableAppMonitoring",checked:v.enabled,onChange:t=>y(o=>({...o,enabled:t.target.checked})),className:"checkbox"}),e.jsx("label",{htmlFor:"enableAppMonitoring",className:"text-sm text-slate-300",children:s("tools.app.enable")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:s("tools.app.recipients")}),e.jsx("button",{className:"btn-outline text-xs",onClick:L,children:s("tools.app.addRecipient")})]}),e.jsxs("div",{className:"space-y-1",children:[Array.isArray(v.notificationRecipients)&&v.notificationRecipients.map(t=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:t}),e.jsx("button",{className:"icon-btn",onClick:()=>E(t),children:"×"})]},t)),(!v.notificationRecipients||v.notificationRecipients.length===0)&&e.jsx("p",{className:"text-xs text-slate-500",children:s("tools.app.noRecipients")})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:s("tools.app.listTitle")}),e.jsx("button",{className:"btn-outline text-xs",onClick:N,children:s("tools.app.addApplication")})]}),v.applications.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:s("tools.app.empty")}):e.jsx("div",{className:"space-y-2",children:Array.isArray(v.applications)&&v.applications.map(t=>{const o=D.has(t.id);return e.jsxs("div",{className:"border border-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-900/30 hover:bg-slate-900/50",children:[e.jsx("input",{type:"checkbox",checked:t.enabled,onChange:c=>m(t.id,{enabled:c.target.checked}),className:"checkbox",onClick:c=>c.stopPropagation()}),e.jsx("span",{className:"flex-1 text-sm font-medium text-slate-200 min-w-0 truncate",children:t.name||s("tools.app.namePlaceholder")}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s("tools.app.checkInterval"),": ",t.checkIntervalSeconds,"s"]}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s("tools.app.restartDelay"),": ",t.restartDelaySeconds,"s"]}),e.jsx("button",{className:"icon-btn text-slate-400 hover:text-white",onClick:()=>{d(c=>{const M=new Set(c);return M.has(t.id)?M.delete(t.id):M.add(t.id),M})},title:o?"Collapse":"Expand",children:o?e.jsx(xe,{size:16}):e.jsx(ke,{size:16})}),e.jsx("button",{className:"icon-btn text-red-400 hover:text-red-300",onClick:()=>T(t.id),title:"Delete",children:e.jsx(X,{size:14})})]}),o&&e.jsxs("div",{className:"p-4 space-y-3 border-t border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.namePlaceholder")}),e.jsx("input",{type:"text",className:"input-text w-full",placeholder:s("tools.app.namePlaceholder"),value:t.name,onChange:c=>m(t.id,{name:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.executablePath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input-text flex-1",placeholder:s("tools.app.executablePlaceholder"),value:q(t.executablePath||""),onChange:c=>{const M=c.target.value.replace(/\\\\/g,"\\");m(t.id,{executablePath:M})}}),e.jsx("button",{className:"btn-outline",onClick:()=>{I(t.id),n(!0)},children:e.jsx(me,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.checkInterval")}),e.jsx("input",{type:"number",min:1,max:3600,className:"input-text",value:t.checkIntervalSeconds,onChange:c=>m(t.id,{checkIntervalSeconds:Number(c.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.restartDelay")}),e.jsx("input",{type:"number",min:0,max:300,className:"input-text",value:t.restartDelaySeconds,onChange:c=>m(t.id,{restartDelaySeconds:Number(c.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.arguments")}),e.jsx("input",{type:"text",className:"input-text",placeholder:s("tools.app.argumentsPlaceholder"),value:t.arguments||"",onChange:c=>m(t.id,{arguments:c.target.value||null})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.workingDirectory")}),e.jsx("input",{type:"text",className:"input-text",placeholder:s("tools.app.workingPlaceholder"),value:q(t.workingDirectory||""),onChange:c=>{const M=c.target.value.replace(/\\\\/g,"\\");m(t.id,{workingDirectory:M||null})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:s("tools.app.eventLogSource")}),e.jsx("input",{type:"text",className:"input-text w-full",placeholder:s("tools.app.eventLogPlaceholder"),value:t.eventLogSource||"",onChange:c=>m(t.id,{eventLogSource:c.target.value||null})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s("tools.app.eventLogHint")})]})]})]},t.id)})})]})]})]}),e.jsx(W,{name:"ApplicationMonitor",title:s("tools.app.logTitle"),subfolder:"ApplicationMonitor"}),z&&e.jsx(Te,{initialPath:C&&(v.applications||[]).find(t=>t.id===C)?.executablePath||"",onSelect:i,onCancel:()=>{n(!1),I(null)},fileExtensions:[".exe",".bat",".cmd",".com",".scr",".vbs",".js",".ps1"]})]})}function Ue({t:s}){const[b,k]=r.useState(null),[z,n]=r.useState(!1),[C,I]=r.useState(!1),D=async x=>{I(!0),n(!1);try{if(b)try{await le(b.id)}catch{}const u=await ae(x);k(u),P(`Terminal created (${x})`,"success")}catch(u){P(`Failed to create terminal: ${u instanceof Error?u.message:"Unknown error"}`,"error")}finally{I(!1)}},d=async()=>{if(b)try{await le(b.id),k(null),P("Terminal closed","success")}catch(x){P(`Failed to close terminal: ${x instanceof Error?x.message:"Unknown error"}`,"error")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Terminal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn-outline",onClick:async()=>{try{const u=`/terminal-popup?id=${(await ae(b.shellType)).id}`;window.open(u,"_blank","width=800,height=600")}catch(x){P(`Failed to open popup: ${x instanceof Error?x.message:"Unknown error"}`,"error")}},title:"Open terminal in a new window",children:[e.jsx(Se,{size:16})," Open in Popup"]}),e.jsxs("button",{className:"btn-outline",onClick:d,children:[e.jsx(J,{size:16})," Close Terminal"]})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>n(!0),disabled:C,children:[e.jsx(K,{size:16})," New Terminal"]})]})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Select Shell"}),e.jsx("button",{className:"text-slate-400 hover:text-white",onClick:()=>n(!1),children:e.jsx(J,{size:20})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full p-4 bg-slate-900/50 hover:bg-slate-900 border border-slate-700 rounded-lg text-left transition-colors",onClick:()=>D("cmd"),children:[e.jsx("div",{className:"font-medium text-white",children:"Command Prompt (cmd.exe)"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Windows Command Prompt"})]}),e.jsxs("button",{className:"w-full p-4 bg-slate-900/50 hover:bg-slate-900 border border-slate-700 rounded-lg text-left transition-colors",onClick:()=>D("powershell"),children:[e.jsx("div",{className:"font-medium text-white",children:"PowerShell"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Windows PowerShell"})]})]})]})}),b?e.jsx("div",{className:"h-[600px]",children:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full bg-slate-900 rounded-lg border border-slate-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-sky-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Loading terminal..."})]})}),children:e.jsx(ze,{sessionId:b.id,onClose:d})})}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(K,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"No active terminal"}),e.jsx("p",{className:"text-sm",children:'Click "New Terminal" to create one'})]})]}),e.jsx(Oe,{t:s})]})}function Ee({t:s}){return e.jsx(W,{name:"Screenshots",title:s("tools.screenshots.logTitle"),subfolder:"Screenshots"})}function Oe({t:s}){return e.jsx(W,{name:"Terminal",title:s("tools.terminal.logTitle"),subfolder:"Terminal"})}function $e({t:s}){return e.jsx(W,{name:"VNC",title:s("tools.vnc.logTitle"),subfolder:"VNC"})}function Be({t:s}){const[b,k]=r.useState(!1),[z,n]=r.useState(!1),[C,I]=r.useState(""),{data:D}=$("vnc-config",()=>R("/api/vnc/config")),{data:d,mutate:x}=$("vnc-status",()=>R("/api/vnc/status"),{refreshInterval:2e3,revalidateOnFocus:!0,revalidateOnReconnect:!0});r.useEffect(()=>{x()},[x]);const u=async()=>{k(!0);try{await R("/api/vnc/start",{method:"POST"}),await x(),P(s("tools.vnc.startSuccess"),"success")}catch(m){P(s("tools.vnc.startFailure",{message:m instanceof Error?m.message:String(m)}),"error")}finally{k(!1)}},v=async()=>{n(!0);try{await R("/api/vnc/stop",{method:"POST"}),await x(),P(s("tools.vnc.stopSuccess"),"success")}catch(m){P(s("tools.vnc.stopFailure",{message:m instanceof Error?m.message:String(m)}),"error")}finally{n(!1)}},y=()=>{if(!d||!D)return;const m=d.allowRemote?window.location.hostname:"127.0.0.1",i=d.port;let T=C;if(D.hasPassword&&!T){const t=prompt("VNC server requires a password. Please enter the password:");if(!t){P("Password is required to connect to the VNC server.","error");return}T=t,I(t)}localStorage.setItem("vnc_host",m),localStorage.setItem("vnc_port",i.toString()),T?localStorage.setItem("vnc_password",T):localStorage.removeItem("vnc_password");const L=`/vnc-viewer?host=${encodeURIComponent(m)}&port=${i}${T?`&password=${encodeURIComponent(T)}`:""}`;window.open(L,"VNC Viewer",`width=${screen.width},height=${screen.height},fullscreen=yes,resizable=yes,scrollbars=no`)||P("Popup blocked. Please allow popups for this site to connect to VNC.","error")};if(!D)return e.jsx("div",{className:"text-sm text-slate-400",children:s("tools.vnc.loading")});const S=d?.allowRemote?window.location.hostname:"127.0.0.1",N=d?.isRunning?`${S}:${d.port}`:null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h3",{className:"panel-title mb-0",children:s("tools.vnc.statusTitle")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:s("tools.vnc.status")}),e.jsx("span",{className:`text-sm font-semibold ${d?.isRunning?"text-green-400":"text-slate-400"}`,children:d?.isRunning?s("tools.vnc.running"):s("tools.vnc.stopped")})]}),d?.isRunning&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:s("tools.vnc.connections")}),e.jsx("span",{className:"text-sm font-semibold text-white",children:d.connectionCount})]}),N&&e.jsxs("div",{className:"bg-slate-900/60 rounded-lg p-3 border border-slate-800",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:s("tools.vnc.connectionInfo")}),e.jsx("p",{className:"text-sm font-mono text-white",children:N}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:s("tools.vnc.connectionHint")})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[d?.isRunning?e.jsxs("button",{className:"btn-primary flex-1",onClick:y,disabled:!d.isRunning,children:[e.jsx(he,{size:16})," Connect"]}):e.jsx("button",{className:"btn-primary flex-1",onClick:u,disabled:b||z||!D.enabled,children:b?s("tools.vnc.starting"):"Start Server"}),e.jsx("button",{className:"btn-outline flex-1",onClick:v,disabled:b||z||!d?.isRunning,children:s(z?"tools.vnc.stopping":"tools.vnc.stop")}),e.jsx("button",{className:"btn-outline",onClick:()=>x(),children:e.jsx(Q,{size:16})})]})]})]}),e.jsx($e,{t:s})]})}export{Ke as default};
