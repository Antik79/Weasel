const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-vnc-BgsbSd6u.js","assets/vendor-terminal-Co9mG8Of.js","assets/vendor-terminal-C0BCwPpi.css"])))=>i.map(i=>d[i]);
import{r as a,j as o,_ as v}from"./index-DO9zxgcv.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";let h;function V({host:l,port:f,password:c,onDisconnect:d}){const u=a.useRef(null),i=a.useRef(null),[m,w]=a.useState(!1),[g,n]=a.useState("Connecting..."),p=a.useRef(!1);a.useEffect(()=>{if(!u.current)return;const C=u.current,b=window.location.protocol==="https:"?"wss:":"ws:",E=window.location.host,y=`${b}//${E}/api/vnc/ws?host=${encodeURIComponent(l)}&port=${f}`;return(async()=>{try{let r;try{r=await v(()=>import("./vendor-vnc-BgsbSd6u.js").then(t=>t.r),__vite__mapDeps([0,1,2])),h=r.default||r.RFB||r}catch{try{r=await v(()=>import("./vendor-vnc-BgsbSd6u.js").then(s=>s.r),__vite__mapDeps([0,1,2])),h=r.default||r.RFB||r}catch(s){console.error("Failed to import noVNC:",s),n("Failed to load VNC client library");return}}if(!h){n("VNC client library not available");return}const e=new h(C,y);c&&(e.credentials={password:c}),e.addEventListener("connect",()=>{w(!0),n("Connected")}),e.addEventListener("desktopname",t=>{}),e.addEventListener("disconnect",t=>{w(!1);const s=t.detail?.reason||t.detail?.message||"Unknown reason";n(`Disconnected: ${t.detail?.clean?"Clean disconnect":s}`),p.current&&d?.()}),e.addEventListener("credentialsrequired",t=>{if(n("Sending credentials..."),c){e.credentials={password:c};try{if(typeof e.sendCredentials=="function"){e.sendCredentials({password:c});return}if(typeof e.sendPassword=="function"){e.sendPassword(c);return}}catch(s){console.error("Error in credentialsrequired handler:",s),n("Error sending credentials")}}else n("Password required but not provided"),console.error("VNC requires password but none was provided")}),e.addEventListener("securityfailure",t=>{const s=t.detail?.reason||t.detail?.message||"Authentication failed";n(`Security failure: ${s}`),console.error("VNC security failure",t.detail,t)}),e.addEventListener("error",t=>{const s=t.detail?.message||t.detail?.reason||"Connection error";n(`Error: ${s}`),console.error("VNC error",t.detail,t)}),e.scaleViewport=!0,e.resizeSession=!1,e.clipViewport=!1,e.showDotCursor=!0,e.viewOnly=!1,e.focusOnClick=!0,i.current=e}catch(r){console.error("Failed to create VNC connection",r),n(`Connection error: ${r instanceof Error?r.message:"Unknown error"}`)}})(),()=>{p.current=!0,i.current&&(i.current.disconnect(),i.current=null)}},[l,f,c,d]);const x=()=>{p.current=!0,i.current&&i.current.disconnect()};return o.jsxs("div",{className:"flex flex-col w-full h-full bg-black",children:[o.jsxs("div",{className:"bg-slate-900/90 text-white p-2 flex items-center justify-between z-10 shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${m?"bg-green-500":"bg-red-500"}`}),o.jsx("span",{className:"text-sm",children:g})]}),o.jsx("button",{onClick:x,className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm",children:"Disconnect"})]}),o.jsx("div",{ref:u,className:"flex-1 w-full overflow-hidden",style:{display:"block",position:"relative"}})]})}function F(){const[l,f]=a.useState(null);a.useEffect(()=>{const d=new URLSearchParams(window.location.search),u=d.get("host")||localStorage.getItem("vnc_host")||"localhost",i=parseInt(d.get("port")||localStorage.getItem("vnc_port")||"5900",10),m=d.get("password"),w=m?decodeURIComponent(m):localStorage.getItem("vnc_password")||void 0;f({host:u,port:i,password:w}),setTimeout(async()=>{try{document.documentElement.requestFullscreen&&await document.documentElement.requestFullscreen()}catch(n){console.log("Could not enter fullscreen:",n)}},100)},[]);const c=()=>{document.fullscreenElement&&document.exitFullscreen(),setTimeout(()=>{window.close()},500)};return l?o.jsx("div",{className:"w-screen h-screen bg-black overflow-hidden",children:o.jsx(V,{host:l.host,port:l.port,password:l.password,onDisconnect:c})}):o.jsx("div",{className:"w-screen h-screen bg-black flex items-center justify-center text-white",children:o.jsx("div",{children:"Loading VNC connection..."})})}export{F as default};
