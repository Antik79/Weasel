import{u as G,r as n,a as M,b as W,j as e,R as E,A as p,d as j,F as H,f as O,e as X}from"./index-Ce5nNHDR.js";import{A as _,S as J}from"./search-C8WW5tra.js";import{F as K}from"./folder-CipFuzDb.js";import{D as A}from"./download-DAaXhITR.js";import"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";const V=i=>{const a=new URL("/api/logs",window.location.origin);return i&&a.searchParams.set("subfolder",i),W(a.toString())},D=(i,a)=>{const m=new URL(`/api/logs/${encodeURIComponent(i)}`,window.location.origin);a&&m.searchParams.set("subfolder",a),window.open(m.toString(),"_blank")};function le(){const{t:i}=G(),[a,m]=n.useState(null),[c,x]=n.useState(null),[u,I]=n.useState(""),[r,P]=n.useState({key:"name",direction:"asc"}),[f,U]=n.useState({key:"name",direction:"asc"}),[$,b]=n.useState(33),[y,k]=n.useState(!1),v=n.useRef(null),{data:N,isLoading:h,mutate:B}=M(["logs",a],()=>V(a??void 0),{refreshInterval:15e3}),d=N?.files??[];N?.folder;const L=N?.subfolders??[],{data:T,isLoading:S}=M(c?["log",c,a]:null,([,s,t])=>{const l=new URL(`/api/logs/${encodeURIComponent(s)}`,window.location.origin);return t&&l.searchParams.set("subfolder",t),W(l.toString())},{revalidateOnFocus:!0,refreshInterval:2e3});n.useEffect(()=>{!c&&d.length>0&&x(d[0].name)},[c,d]),n.useEffect(()=>{if(!y)return;const s=l=>{if(!v.current)return;const o=v.current.getBoundingClientRect(),g=(l.clientX-o.left)/o.width*100,F=Math.max(20,Math.min(60,g));b(F),localStorage.setItem("weasel.logs.leftPanelWidth",F.toString())},t=()=>{k(!1)};return document.addEventListener("mousemove",s),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",t)}},[y]),n.useEffect(()=>{const s=localStorage.getItem("weasel.logs.leftPanelWidth");s&&b(parseInt(s))},[]);const C=n.useMemo(()=>{const s=[...L];return a&&!a.includes("/Archive")&&s.push(`${a}/Archive`),s.sort((t,l)=>{let o=0;switch(f.key){case"name":o=t.localeCompare(l);break;case"date":o=t.localeCompare(l);break}return f.direction==="asc"?o:-o})},[L,a,f]),z=n.useMemo(()=>{if(!Array.isArray(d))return[];if(!u)return d;const s=u.toLowerCase();return d.filter(t=>t.name.toLowerCase().includes(s))},[d,u]),R=n.useMemo(()=>[...z].sort((s,t)=>{let l=0;switch(r.key){case"name":l=s.name.localeCompare(t.name);break;case"size":l=s.sizeBytes-t.sizeBytes;break;case"date":l=new Date(s.lastModified).getTime()-new Date(t.lastModified).getTime();break}return r.direction==="asc"?l:-l}),[z,r]),w=s=>{P(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},Q=s=>{U(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},q=()=>{k(!0)};return n.useEffect(()=>{x(null)},[a]),e.jsx("section",{className:"space-y-4",children:e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded border border-slate-800 overflow-hidden",children:[e.jsxs("span",{className:"text-slate-500 flex-shrink-0",children:[i("common.path"),":"]}),e.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0 overflow-hidden",children:[e.jsx("button",{className:"text-sm font-medium text-sky-400 hover:text-sky-300 hover:underline flex-shrink-0",onClick:()=>{m(null),x(null)},title:"Go to root",children:"Logs"}),a&&a.split("/").filter(Boolean).map((s,t,l)=>{const o=l.slice(0,t+1).join("/"),g=t===l.length-1;return e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 min-w-0",children:[e.jsx("span",{className:"text-slate-500 flex-shrink-0",children:"/"}),e.jsx("button",{className:`text-sm font-medium truncate max-w-[150px] ${g?"text-white":"text-sky-400 hover:text-sky-300 hover:underline"}`,onClick:()=>{g||(m(o),x(null))},disabled:g,title:o,children:s})]},t)})]}),e.jsx("div",{className:"flex gap-2 flex-shrink-0",children:e.jsx("button",{className:"icon-btn",onClick:()=>B(),title:i("common.refresh"),children:e.jsx(E,{size:16})})})]}),e.jsxs("div",{ref:v,className:"flex flex-row gap-2",style:{height:"calc(100vh - 200px)",minHeight:"600px"},children:[e.jsxs("div",{className:"panel flex flex-col overflow-hidden",style:{width:`${$}%`,minWidth:"250px"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 flex-shrink-0",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Folders"}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>Q("name"),children:["Name ",f.key==="name"&&(f.direction==="asc"?e.jsx(p,{size:12}):e.jsx(j,{size:12}))]})})]}),e.jsxs("div",{className:"divide-y divide-slate-800 overflow-y-auto flex-1 pr-2",children:[h&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:"Loading…"}),!h&&C.length===0&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:"No folders"}),!h&&C.map(s=>{const t=s.toLowerCase().includes("archive"),l=s.split("/").pop()||s;return e.jsx("div",{className:`item-row hover:bg-slate-800/50 cursor-pointer ${a===s?"bg-slate-800/70":""}`,onClick:()=>{m(s),x(null)},children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t?e.jsx(_,{size:18,className:"text-amber-300 flex-shrink-0"}):e.jsx(K,{size:18,className:"text-amber-300 flex-shrink-0"}),e.jsx("div",{className:"min-w-0",children:e.jsx("p",{className:"font-medium truncate",children:l})})]})},s)})]})]}),e.jsx("div",{className:"w-2 cursor-col-resize bg-slate-900 hover:bg-sky-500/50 transition-colors flex items-center justify-center z-10 flex-shrink-0 rounded",onMouseDown:q,children:e.jsx("div",{className:"h-8 w-1 bg-slate-600 rounded-full"})}),e.jsxs("div",{className:"panel flex-1 flex flex-col overflow-hidden",style:{minWidth:"400px"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 flex-shrink-0",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Log Files"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>w("name"),children:["Name ",r.key==="name"&&(r.direction==="asc"?e.jsx(p,{size:12}):e.jsx(j,{size:12}))]}),e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>w("size"),children:["Size ",r.key==="size"&&(r.direction==="asc"?e.jsx(p,{size:12}):e.jsx(j,{size:12}))]}),e.jsxs("button",{className:"hover:text-white flex items-center gap-1",onClick:()=>w("date"),children:["Date ",r.key==="date"&&(r.direction==="asc"?e.jsx(p,{size:12}):e.jsx(j,{size:12}))]})]})]}),e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search log files...",value:u,onChange:s=>I(s.target.value),className:"w-full px-3 py-2 pl-9 bg-slate-900/50 border border-slate-800 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent"}),e.jsx(J,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"})]})}),e.jsxs("div",{className:"divide-y divide-slate-800 overflow-y-auto flex-1 pr-2",children:[h&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:"Loading…"}),!h&&R.length===0&&e.jsx("p",{className:"py-4 text-sm text-slate-400",children:u?"No files match your search":"No log files"}),!h&&R.map(s=>e.jsxs("div",{className:`item-row hover:bg-slate-800/50 cursor-pointer group ${c===s.name?"bg-slate-800/70":""}`,onClick:()=>x(s.name),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(H,{size:18,className:"text-blue-300 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[O(s.lastModified)," • ",X(s.sizeBytes)]})]})]}),e.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{className:"icon-btn",onClick:t=>{t.stopPropagation(),D(s.name,a)},title:"Download",children:e.jsx(A,{size:14})})})]},s.name))]})]})]}),c&&e.jsxs("div",{className:"bg-slate-950/70 border border-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"font-semibold text-white",children:c}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{className:"btn-outline",onClick:()=>D(c,a),children:[e.jsx(A,{size:16})," ",i("tools.logs.download")]})})]}),S&&e.jsx("p",{className:"text-sm text-slate-400",children:i("tools.logs.loadingEntry")}),!S&&e.jsx("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap max-h-[400px] overflow-y-auto font-mono bg-slate-900/50 p-3 rounded border border-slate-800",children:T||""}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500 flex items-center gap-2",children:[e.jsx(E,{size:12,className:"animate-spin"}),e.jsx("span",{children:"Tailing log (auto-refreshing every 2 seconds)"})]})]})]})})}export{le as default};
