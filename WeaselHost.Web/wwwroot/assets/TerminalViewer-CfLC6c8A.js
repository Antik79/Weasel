import{r as t,j as s}from"./index-eo1TGWw1.js";import{x as y,a as R}from"./vendor-terminal-Co9mG8Of.js";import"./vendor-utils-BeCPKUKe.js";function v({sessionId:u,onClose:f}){const i=t.useRef(null),c=t.useRef(null),a=t.useRef(null),l=t.useRef(null),[x,m]=t.useState(!1),n=t.useRef(null);return t.useEffect(()=>{if(!i.current)return;const e=new y.Terminal({theme:{background:"#0f172a",foreground:"#e2e8f0",cursor:"#38bdf8",selection:"#1e3a8a80",black:"#1e293b",red:"#ef4444",green:"#22c55e",yellow:"#eab308",blue:"#3b82f6",magenta:"#a855f7",cyan:"#06b6d4",white:"#e2e8f0",brightBlack:"#475569",brightRed:"#f87171",brightGreen:"#4ade80",brightYellow:"#fbbf24",brightBlue:"#60a5fa",brightMagenta:"#c084fc",brightCyan:"#22d3ee",brightWhite:"#f1f5f9"},fontSize:14,fontFamily:"Consolas, 'Courier New', monospace",cursorBlink:!0,cursorStyle:"block",allowTransparency:!0}),d=new R.FitAddon;e.loadAddon(d),e.open(i.current),d.fit(),c.current=e,a.current=d;const w=()=>{const h=window.location.protocol==="https:"?"wss:":"ws:",p=window.location.host,g=`${h}//${p}/api/terminal/ws?id=${encodeURIComponent(u)}`;try{const r=new WebSocket(g);l.current=r,r.onopen=()=>{m(!0),n.current&&(window.clearTimeout(n.current),n.current=null),e.clear(),e.write(`\r
\x1B[32mConnected to terminal\x1B[0m\r
`)},r.onmessage=o=>{typeof o.data=="string"&&e.write(o.data)},r.onerror=o=>{console.error("Terminal WebSocket error:",o),e.write(`\r
\x1B[31mConnection error\x1B[0m\r
`)},r.onclose=()=>{m(!1),e.write(`\r
\x1B[33mConnection closed\x1B[0m\r
`),f||(n.current=window.setTimeout(()=>{i.current&&w()},2e3))},e.onData(o=>{r.readyState===WebSocket.OPEN&&r.send(o)});const b=()=>{a.current&&(a.current.fit(),r.readyState===WebSocket.OPEN&&r.send(JSON.stringify({type:"resize",rows:e.rows,cols:e.cols})))};return window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}}catch(r){console.error("Failed to create WebSocket:",r),e.write(`\r
\x1B[31mFailed to connect\x1B[0m\r
`)}};return w(),()=>{n.current&&window.clearTimeout(n.current),l.current&&l.current.close(),c.current&&c.current.dispose()}},[u,f]),s.jsxs("div",{className:"relative w-full h-full bg-slate-900 rounded-lg overflow-hidden border border-slate-800",children:[s.jsx("div",{ref:i,className:"w-full h-full",style:{minHeight:"400px"}}),!x&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-slate-400 mb-2",children:"Connecting to terminal..."}),s.jsx("div",{className:"w-8 h-8 border-2 border-sky-500 border-t-transparent rounded-full animate-spin mx-auto"})]})})]})}export{v as default};
