const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TerminalViewer-CUGATzXn.js","assets/index-CFy-3w2c.js","assets/vendor-utils-CpUfumj7.js","assets/vendor-terminal-CTS2sXWF.js","assets/vendor-terminal-C0BCwPpi.css","assets/index-DkMVpPBI.css"])))=>i.map(i=>d[i]);
import{c as ze,u as U,b as D,j as e,X as Z,q as W,a as Je,m as We,M as Q,H as ne,t as he,v as de,S as te,R as ie,f as re,h as ye,P as we,s as v,C as Xe,w as Te,l as Qe,e as B,E as Ye,x as Se,y as ke,_ as Ze}from"./index-CFy-3w2c.js";import{r as c}from"./vendor-utils-CpUfumj7.js";import{F as Ce,S as ae,I as Pe}from"./square-check-big-bHqBvSos.js";import{C as De,L as Ge,a as oe,T as X,F as xe,b as Ke,S as es}from"./ToggleBar-C2bORH6u.js";import{F as ss}from"./folder-BcBcgh9m.js";import{T as J,L as G,C as ts}from"./LogPanel-BApmYpq7.js";import{D as le}from"./download-DHqHKtrx.js";import{E as ue}from"./eye-oiPQLzsB.js";import"./vendor-terminal-CTS2sXWF.js";import"./check-BKh3xXWJ.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=ze("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=ze("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),ns=t=>D(`/api/fs?path=${encodeURIComponent(t)}`),is=()=>D("/api/fs/drives");function rs({initialPath:t,onSelect:w,onCancel:A,fileExtensions:S}){const[f,N]=c.useState(()=>{if(t){const x=t.lastIndexOf("\\");if(x>0)return t.substring(0,x)}return""}),O=f||"drives",{data:z,error:I,isLoading:n}=U(O,f?()=>ns(f):is),h=z?.filter(x=>{if(x.isDirectory||!S||S.length===0)return!0;const F=x.name.substring(x.name.lastIndexOf(".")).toLowerCase();return S.some(M=>M.toLowerCase()===F)})||[],k=h.filter(x=>x.isDirectory),b=h.filter(x=>!x.isDirectory),g=x=>{N(x)},y=x=>{w(x.fullPath)},C=()=>{if(!f)return;const x=f.split(/[/\\]/);if(x.pop(),x.length===0||x.length===1&&x[0]==="")N("");else{const F=x.join("\\")||"";f.endsWith(":\\")||f.length===2&&f[1]===":"?N(""):N(F)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between bg-slate-800 rounded-t-lg",children:[e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(Ce,{className:"text-blue-400",size:20}),"Select File"]}),e.jsx("button",{onClick:A,className:"text-slate-400 hover:text-white",children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:"p-2 bg-slate-800 border-b border-slate-700 flex gap-2 items-center",children:[e.jsx("button",{onClick:C,disabled:!f,className:"p-2 hover:bg-slate-700 rounded text-slate-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Go Up",children:e.jsx(De,{size:20})}),e.jsx("div",{className:"flex-1 bg-slate-950 border border-slate-700 rounded px-3 py-1.5 text-sm text-slate-300 font-mono truncate",children:W(f)||"This PC"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 min-h-[300px]",children:[n&&e.jsxs("div",{className:"flex items-center justify-center h-full text-slate-400 gap-2",children:[e.jsx(Ge,{className:"animate-spin",size:24}),"Loading..."]}),I&&e.jsxs("div",{className:"flex items-center justify-center h-full text-red-400 gap-2",children:[e.jsx(Z,{size:24}),"Failed to load directory"]}),!n&&!I&&h.length===0&&e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 italic",children:"No items found"}),!n&&!I&&e.jsxs("div",{className:"space-y-1",children:[k.map(x=>e.jsxs("button",{onClick:()=>g(x.fullPath||x.name),className:"w-full flex items-center gap-3 p-2 hover:bg-slate-800 rounded text-left group",children:[e.jsx(ss,{className:"text-yellow-500 group-hover:text-yellow-400",size:20}),e.jsx("span",{className:"text-slate-200 text-sm flex-1 truncate",children:x.name})]},x.fullPath||x.name)),b.map(x=>e.jsxs("button",{onClick:()=>y(x),className:"w-full flex items-center gap-3 p-2 hover:bg-slate-800 rounded text-left group",children:[e.jsx(Ce,{className:"text-blue-400 group-hover:text-blue-300",size:20}),e.jsx("span",{className:"text-slate-200 text-sm flex-1 truncate",children:x.name})]},x.fullPath||x.name))]})]}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-800 rounded-b-lg flex justify-end gap-2",children:e.jsx("button",{onClick:A,className:"px-4 py-2 rounded text-sm font-medium text-slate-300 hover:bg-slate-700 transition-colors",children:"Cancel"})})]})})}const os=c.lazy(()=>Ze(()=>import("./TerminalViewer-CUGATzXn.js"),__vite__mapDeps([0,1,2,3,4,5]))),pe=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const w=Math.random()*16|0;return(t==="x"?w:w&3|8).toString(16)}),cs=()=>D("/api/settings/capture"),me=t=>{const w=Te(),A=new URL("/api/fs/raw",window.location.origin);A.searchParams.set("path",t),w&&A.searchParams.set("token",w);const S=A.toString();return console.log("[Screenshots] Building raw URL for path:",t,"-> URL:",S),S};function Ps(){const{t}=Je(),A=We().theme||defaultTheme,[S,f]=c.useState("screenshots"),[N,O]=c.useState(null),[z,I]=c.useState(!1),[n,h]=c.useState(new Set);c.useEffect(()=>{const a=()=>{const r=window.location.hash.slice(1);if(!r)return;const p=r.split("/").filter(Boolean);if(p[0]==="tools"&&p[1]){const T=p[1];["application-monitor","storage-monitor","terminal","vnc","screenshots"].includes(T)&&f(T)}};return a(),window.addEventListener("hashchange",a),()=>window.removeEventListener("hashchange",a)},[]),c.useEffect(()=>{const r=window.location.hash.slice(1).split("/").filter(Boolean);r[0]==="tools"&&r[1]!==S&&(window.location.hash=`/tools/${S}`)},[S]);const[k,b]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},variant:"info"}),{data:g,mutate:y}=U("capture-settings",cs),C=g?.folder??"",x=g?.timedFolder??"",[F,M]=c.useState({enableIntervalCapture:!1,intervalSeconds:60});c.useEffect(()=>{g&&M({enableIntervalCapture:g.enableIntervalCapture??!1,intervalSeconds:g.intervalSeconds??60})},[g]);const{data:E,isLoading:i,mutate:d}=U(C?["screenshots",C]:null,([,a])=>{const r=new URL("/api/fs",window.location.origin);return r.searchParams.set("path",a),D(r.toString())},{revalidateOnFocus:!1}),m=c.useMemo(()=>!E||!Array.isArray(E)?[]:E.filter(a=>a.name.toLowerCase().endsWith(".png")),[E]),{data:R,isLoading:_,mutate:s}=U(x?["timed-screenshots",x]:null,([,a])=>{const r=new URL("/api/fs",window.location.origin);return r.searchParams.set("path",a),D(r.toString())},{revalidateOnFocus:!1}),l=c.useMemo(()=>!R||!Array.isArray(R)?[]:R.filter(a=>a.name.toLowerCase().endsWith(".png")),[R]),[o,u]=c.useState(new Set),[j,P]=c.useState(()=>{const a=localStorage.getItem("weasel.screenshots.capturedPageSize");return a?parseInt(a):25}),[L,$]=c.useState(1),[H,Ae]=c.useState(()=>{const a=localStorage.getItem("weasel.screenshots.timedPageSize");return a?parseInt(a):25}),[ce,fe]=c.useState(1),je=c.useMemo(()=>{if(j===0)return m;const a=(L-1)*j,r=a+j;return m.slice(a,r)},[m,j,L]),be=c.useMemo(()=>{if(H===0)return l;const a=(ce-1)*H,r=a+H;return l.slice(a,r)},[l,H,ce]),Ie=a=>{P(a),$(1),localStorage.setItem("weasel.screenshots.capturedPageSize",a.toString())},Re=a=>{Ae(a),fe(1),localStorage.setItem("weasel.screenshots.timedPageSize",a.toString())};c.useEffect(()=>()=>{N&&URL.revokeObjectURL(N.url)},[N]);const K=a=>{O({path:a.fullPath,url:me(a.fullPath)})},[ee,ge]=c.useState(null),Oe=async a=>{ge(a),b({isOpen:!0,title:"Delete Screenshot",message:t("tools.screenshots.deleteConfirm",{name:a.name}),onConfirm:async()=>{if(ee)try{const r=new URL("/api/fs",window.location.origin);r.searchParams.set("path",ee.fullPath),await D(r.toString(),{method:"DELETE"}),N?.path===ee.fullPath&&(URL.revokeObjectURL(N.url),O(null)),h(p=>{const T=new Set(p);return T.delete(ee.fullPath),T}),await d?.(),v("Screenshot deleted successfully","success"),ge(null),b(p=>({...p,isOpen:!1}))}catch(r){v(`Failed to delete screenshot: ${r instanceof Error?r.message:"Unknown error"}`,"error")}},variant:"danger"})},Fe=a=>{h(r=>{const p=new Set(r);return p.has(a)?p.delete(a):p.add(a),p})},Le=()=>{h(new Set(m.map(a=>a.fullPath)))},ve=()=>{h(new Set)},Me=async()=>{if(n.size!==0)try{const a=Array.from(n),r=localStorage.getItem("weasel.csrf")||"local",p=localStorage.getItem("weasel.auth.token"),T={"Content-Type":"application/json","X-Weasel-Csrf":r};p&&(T["X-Weasel-Token"]=p);const q=await fetch("/api/fs/download/bulk",{method:"POST",headers:T,body:JSON.stringify({paths:a})});if(!q.ok)throw new Error(`HTTP ${q.status}: ${q.statusText}`);const se=await q.blob(),V=window.URL.createObjectURL(se),Y=document.createElement("a");Y.href=V,Y.download=`screenshots_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),window.URL.revokeObjectURL(V),h(new Set)}catch(a){v(`Failed to download screenshots: ${a instanceof Error?a.message:String(a)}`,"error")}},Ee=async()=>{if(n.size===0)return;const a=n.size;b({isOpen:!0,title:"Delete Screenshots",message:`Delete ${a} screenshot${a>1?"s":""}?`,onConfirm:async()=>{try{const r=Array.from(n);for(const p of r){const T=new URL("/api/fs",window.location.origin);T.searchParams.set("path",p),await D(T.toString(),{method:"DELETE"}),N?.path===p&&(URL.revokeObjectURL(N.url),O(null))}h(new Set),await d?.(),v(`Deleted ${a} screenshot${a>1?"s":""} successfully`,"success"),b(p=>({...p,isOpen:!1}))}catch(r){v(`Failed to delete screenshots: ${r instanceof Error?r.message:String(r)}`,"error"),b(p=>({...p,isOpen:!1}))}},variant:"danger"})},$e=async()=>{await D("/api/system/screenshot",{method:"POST"}),await d?.()},Ue=async()=>{I(!0);try{await D("/api/settings/capture",{method:"PUT",body:JSON.stringify({folder:g?.folder||"",filenamePattern:g?.filenamePattern||"",timedFolder:g?.timedFolder||"",enableIntervalCapture:F.enableIntervalCapture,intervalSeconds:F.intervalSeconds})}),await y(),v(t("tools.screenshots.saveSuccess"),"success")}catch(a){const r=a instanceof Error?a.message:String(a);v(t("tools.screenshots.saveFailure",{message:r}),"error")}finally{I(!1)}},Ve=a=>{u(r=>{const p=new Set(r);return p.has(a)?p.delete(a):p.add(a),p})},Be=()=>{u(new Set(l.map(a=>a.fullPath)))},Ne=()=>{u(new Set)},_e=async()=>{if(o.size!==0)try{const a=Te(),r=Array.from(o),p={"Content-Type":"application/json"};a&&(p["X-Weasel-Token"]=a);const T=await fetch("/api/fs/download/bulk",{method:"POST",headers:p,body:JSON.stringify({paths:r})});if(!T.ok)throw new Error(`HTTP ${T.status}: ${T.statusText}`);const q=await T.blob(),se=window.URL.createObjectURL(q),V=document.createElement("a");V.href=se,V.download=`timed_screenshots_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(V),V.click(),document.body.removeChild(V),window.URL.revokeObjectURL(se),u(new Set)}catch(a){v(`Failed to download screenshots: ${a instanceof Error?a.message:String(a)}`,"error")}},He=async()=>{if(o.size===0)return;const a=o.size;b({isOpen:!0,title:"Delete Timed Screenshots",message:`Delete ${a} timed screenshot${a>1?"s":""}?`,onConfirm:async()=>{try{const r=Array.from(o);for(const p of r){const T=new URL("/api/fs",window.location.origin);T.searchParams.set("path",p),await D(T.toString(),{method:"DELETE"}),N?.path===p&&(URL.revokeObjectURL(N.url),O(null))}u(new Set),await s?.(),v(`Deleted ${a} timed screenshot${a>1?"s":""} successfully`,"success"),b(p=>({...p,isOpen:!1}))}catch(r){v(`Failed to delete screenshots: ${r instanceof Error?r.message:String(r)}`,"error"),b(p=>({...p,isOpen:!1}))}},variant:"danger"})},qe=[{key:"application-monitor",label:t("tools.tabs.appMonitor"),icon:e.jsx(Q,{size:16})},{key:"storage-monitor",label:"Storage Monitor",icon:e.jsx(ne,{size:16})},{key:"terminal",label:"Terminal",icon:e.jsx(he,{size:16})},{key:"vnc",label:"VNC",icon:e.jsx(Q,{size:16})},{key:"screenshots",label:t("tools.tabs.screenshots"),icon:e.jsx(de,{size:16})}];return e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"submenu-container",children:qe.map(({key:a,label:r,icon:p})=>e.jsxs("button",{onClick:()=>f(a),className:`submenu-tab ${S===a?"active":""}`,children:[p,r]},a))}),S==="screenshots"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"panel-title mb-0 flex items-center gap-2",children:[e.jsx(as,{size:18})," ",t("tools.screenshots.timedTitle")]}),e.jsxs("button",{className:"btn-primary",onClick:Ue,disabled:z,children:[e.jsx(oe,{size:16})," ",t(z?"tools.screenshots.saving":"tools.screenshots.save")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{label:t("tools.screenshots.enableAuto"),description:"Automatically capture screenshots at interval",enabled:F.enableIntervalCapture,onChange:a=>M({...F,enableIntervalCapture:a}),icon:e.jsx(de,{size:18})}),F.enableIntervalCapture&&e.jsxs("div",{className:"ml-6 pl-4 border-l-2 border-slate-800 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-slate-400",children:t("tools.screenshots.intervalLabel")}),e.jsx("input",{type:"number",min:1,className:"input-text w-24",value:F.intervalSeconds,onChange:a=>M({...F,intervalSeconds:Math.max(1,Number(a.target.value))})})]}),e.jsx("p",{className:"text-xs text-slate-500",children:t("tools.screenshots.intervalHint")})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:t("tools.screenshots.sectionTitle")}),e.jsxs("p",{className:"text-sm text-slate-400",children:[t("tools.screenshots.folderLabel"),": ",W(C)||t("tools.screenshots.folderMissing")]})]}),e.jsxs("div",{className:"flex gap-2",children:[m.length>0&&e.jsx("button",{className:"btn-outline text-xs",onClick:n.size===m.length?ve:Le,children:n.size===m.length?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:14})," Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:14})," Select All"]})}),e.jsxs("button",{className:"btn-primary",onClick:$e,children:[e.jsx(de,{size:16})," ",t("tools.screenshots.takeScreenshot")]}),e.jsxs("button",{className:"btn-outline",onClick:()=>d(),children:[e.jsx(ie,{size:16})," ",t("common.refresh")]})]})]}),i&&e.jsx("p",{className:"text-sm text-slate-400",children:t("tools.screenshots.loading")}),!i&&C&&m.length===0&&e.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx(Pe,{size:16}),t("tools.screenshots.empty")]}),n.size>0&&e.jsx("div",{className:"panel bg-sky-900/20 border-sky-500/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-300",children:[n.size," screenshot",n.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-outline text-xs",onClick:ve,children:"Clear"}),e.jsxs("button",{className:"btn-primary text-xs",onClick:Me,children:[e.jsx(le,{size:14})," Download as ZIP"]}),e.jsxs("button",{className:"btn-outline text-xs text-red-400 hover:text-red-300",onClick:Ee,children:[e.jsx(J,{size:14})," Delete"]})]})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.isArray(je)&&je.map(a=>e.jsxs("div",{className:`screenshot-card ${n.has(a.fullPath)?"ring-2 ring-sky-500":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:me(a.fullPath),alt:a.name,className:"screenshot-thumb",onClick:()=>K(a),onError:r=>{console.error("[Screenshots] Failed to load image:",a.fullPath,r),r.currentTarget.style.backgroundColor="#1e293b",r.currentTarget.style.border="2px solid #ef4444"},onLoad:()=>{console.log("[Screenshots] Image loaded successfully:",a.name)}}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("button",{className:"icon-btn bg-slate-900/80 hover:bg-slate-800/80",onClick:r=>{r.stopPropagation(),Fe(a.fullPath)},title:n.has(a.fullPath)?"Deselect":"Select",children:n.has(a.fullPath)?e.jsx(ae,{size:16,className:"text-sky-400"}):e.jsx(te,{size:16})})})]}),e.jsxs("div",{className:"screenshot-meta",children:[e.jsxs("div",{children:[e.jsx("p",{className:"screenshot-name",children:a.name}),e.jsx("p",{className:"text-xs text-slate-400",children:re(a.modifiedAt)})]}),e.jsxs("div",{className:"screenshot-actions",children:[e.jsx("button",{className:"icon-btn",onClick:()=>K(a),title:t("common.view"),children:e.jsx(ue,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>ye(a.fullPath),title:t("common.download"),children:e.jsx(le,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>Oe(a),title:"Delete",children:e.jsx(J,{size:16})})]})]})]},a.fullPath))}),e.jsx(we,{currentPage:L,totalItems:m.length,pageSize:j,onPageChange:$,onPageSizeChange:Ie})]}),x&&e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:"Timed Screenshots"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Folder: ",W(x)]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.length>0&&e.jsx("button",{className:"btn-outline text-xs",onClick:o.size===l.length?Ne:Be,children:o.size===l.length?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:14})," Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:14})," Select All"]})}),e.jsxs("button",{className:"btn-outline",onClick:()=>s(),children:[e.jsx(ie,{size:16})," ",t("common.refresh")]})]})]}),_&&e.jsx("p",{className:"text-sm text-slate-400",children:"Loading timed screenshots..."}),!_&&l.length===0&&e.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx(Pe,{size:16}),"No timed screenshots found"]}),o.size>0&&e.jsx("div",{className:"panel bg-sky-900/20 border-sky-500/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-300",children:[o.size," timed screenshot",o.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-outline text-xs",onClick:Ne,children:"Clear"}),e.jsxs("button",{className:"btn-primary text-xs",onClick:_e,children:[e.jsx(le,{size:14})," Download as ZIP"]}),e.jsxs("button",{className:"btn-outline text-xs text-red-400 hover:text-red-300",onClick:He,children:[e.jsx(J,{size:14})," Delete"]})]})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.isArray(be)&&be.map(a=>e.jsxs("div",{className:`screenshot-card ${o.has(a.fullPath)?"ring-2 ring-sky-500":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:me(a.fullPath),alt:a.name,className:"screenshot-thumb",onClick:()=>K(a)}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("button",{className:"icon-btn bg-slate-900/80 hover:bg-slate-800/80",onClick:r=>{r.stopPropagation(),Ve(a.fullPath)},title:o.has(a.fullPath)?"Deselect":"Select",children:o.has(a.fullPath)?e.jsx(ae,{size:16,className:"text-sky-400"}):e.jsx(te,{size:16})})})]}),e.jsxs("div",{className:"screenshot-meta",children:[e.jsxs("div",{children:[e.jsx("p",{className:"screenshot-name",children:a.name}),e.jsx("p",{className:"text-xs text-slate-400",children:re(a.modifiedAt)})]}),e.jsxs("div",{className:"screenshot-actions",children:[e.jsx("button",{className:"icon-btn",onClick:()=>K(a),title:t("common.view"),children:e.jsx(ue,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>ye(a.fullPath),title:t("common.download"),children:e.jsx(le,{size:16})}),e.jsx("button",{className:"icon-btn",onClick:()=>{b({isOpen:!0,title:"Delete Timed Screenshot",message:`Delete ${a.name}?`,onConfirm:async()=>{try{const r=new URL("/api/fs",window.location.origin);r.searchParams.set("path",a.fullPath),await D(r.toString(),{method:"DELETE"}),N?.path===a.fullPath&&(URL.revokeObjectURL(N.url),O(null)),u(p=>{const T=new Set(p);return T.delete(a.fullPath),T}),await s?.(),v("Timed screenshot deleted successfully","success"),b(p=>({...p,isOpen:!1}))}catch(r){v(`Failed to delete screenshot: ${r instanceof Error?r.message:"Unknown error"}`,"error"),b(p=>({...p,isOpen:!1}))}},variant:"danger"})},title:"Delete",children:e.jsx(J,{size:16})})]})]})]},a.fullPath))}),e.jsx(we,{currentPage:ce,totalItems:l.length,pageSize:H,onPageChange:fe,onPageSizeChange:Re})]}),N&&e.jsx("div",{className:"modal-backdrop",onClick:()=>O(null),children:e.jsxs("div",{className:"modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-[0.2em]",children:t("tools.screenshots.previewTitle")}),e.jsx("p",{className:"font-semibold text-white break-all",children:N.path})]}),e.jsx("button",{className:"btn-outline",onClick:()=>O(null),children:t("common.cancel")})]}),e.jsx("div",{className:"modal-body",children:e.jsx("img",{src:N.url,alt:"Screenshot preview",className:"w-full rounded-md border border-slate-800"})})]})}),e.jsx(xs,{t})]}),S==="storage-monitor"&&e.jsx(ds,{t,theme:A}),S==="application-monitor"&&e.jsx(ms,{t}),S==="terminal"&&e.jsx(hs,{t}),S==="vnc"&&e.jsx(fs,{t}),e.jsx(Xe,{isOpen:k.isOpen,title:k.title,message:k.message,onConfirm:k.onConfirm,onCancel:()=>b(a=>({...a,isOpen:!1})),variant:k.variant})]})}function ds({t,theme:w}){const[A,S]=c.useState(!1),[f,N]=c.useState(null),[O,z]=c.useState(null),{data:I,mutate:n}=U("disk-monitoring-config",()=>D("/api/disk-monitoring/config")),{data:h,mutate:k}=U("disk-monitoring-status",()=>D("/api/disk-monitoring/status"),{refreshInterval:3e4}),{data:b}=U("available-drives",()=>D("/api/disk-monitoring/drives")),[g,y]=c.useState({enabled:!1,monitoredDrives:[],folderMonitors:[],notificationRecipients:[]});c.useEffect(()=>{I&&y(I)},[I]);const C=c.useCallback(s=>{if(Array.isArray(g.monitoredDrives))return g.monitoredDrives.find(l=>l.driveName===s)},[g.monitoredDrives]),x=c.useCallback((s,l)=>{y(o=>{const u=Array.isArray(o.monitoredDrives)?o.monitoredDrives:[],j=u.find($=>$.driveName===s),P=j?{...j,...l}:{driveName:s,enabled:!0,checkIntervalMinutes:15,thresholdPercent:null,thresholdBytes:null,...l},L=u.filter($=>$.driveName!==s);return{...o,monitoredDrives:[...L,P]}})},[]),F=c.useCallback(async()=>{S(!0);try{await D("/api/disk-monitoring/config",{method:"PUT",body:JSON.stringify(g)}),await n(),await k(),v(t("tools.disk.saveSuccess"),"success")}catch(s){console.error("Failed to save disk monitoring config:",s);const l=s instanceof Error?s.message:String(s);v(t("tools.disk.saveFailure",{message:l}),"error")}finally{S(!1)}},[g,n,k,t]),M=c.useCallback(()=>{const s=window.prompt(t("tools.disk.recipientPrompt"));if(s){const l=Array.isArray(g.notificationRecipients)?g.notificationRecipients:[];l.includes(s)||y(o=>({...o,notificationRecipients:[...l,s]}))}},[g.notificationRecipients,t]),E=c.useCallback(s=>{y(l=>{const o=Array.isArray(l.notificationRecipients)?l.notificationRecipients:[];return{...l,notificationRecipients:o.filter(u=>u!==s)}})},[]),i=b&&Array.isArray(b)?b.find(s=>s.name===f):void 0,d=f?C(f):void 0,m=h?.driveStatuses&&Array.isArray(h.driveStatuses)?h.driveStatuses.find(s=>s.driveName===f):void 0,R=h?.isRunning?t("tools.disk.statusActive"):t("tools.disk.statusInactive"),_=h?.lastCheck?re(h.lastCheck):t("tools.disk.statusNever");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:t("tools.disk.title")}),e.jsxs("p",{className:"text-sm text-slate-400",children:[R," • ",t("tools.disk.lastCheck",{value:_})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"btn-outline",onClick:()=>k(),children:[e.jsx(ie,{size:16})," ",t("common.refresh")]}),e.jsxs("button",{className:"btn-primary",onClick:F,disabled:A,children:[e.jsx(oe,{size:16})," ",t(A?"tools.disk.saving":"tools.disk.save")]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{label:t("tools.disk.enable"),description:"Monitor disk space and send alerts",enabled:g.enabled,onChange:s=>y(l=>({...l,enabled:s})),icon:e.jsx(ne,{size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:t("tools.disk.recipients")}),e.jsx("button",{className:"btn-outline text-xs",onClick:M,children:t("tools.disk.addRecipient")})]}),e.jsxs("div",{className:"space-y-1",children:[Array.isArray(g.notificationRecipients)&&g.notificationRecipients.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:s}),e.jsx("button",{className:"icon-btn",onClick:()=>E(s),children:"×"})]},s)),g.notificationRecipients.length===0&&e.jsx("p",{className:"text-xs text-slate-500",children:t("tools.disk.noRecipients")})]})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h4",{className:"panel-title",children:t("tools.disk.availableDrives")}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:b&&Array.isArray(b)&&b.map(s=>{const l=s.totalBytes-s.freeBytes,o=l/s.totalBytes*100,u=s.freeBytes/s.totalBytes*100,j=C(s.name),P=h?.driveStatuses&&Array.isArray(h.driveStatuses)?h.driveStatuses.find(H=>H.driveName===s.name):void 0,L=f===s.name,$=j?.enabled??!1;return e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-colors ${L?"border-sky-500 bg-slate-900/70":$?"border-slate-700 bg-slate-900/50":"border-slate-800 bg-slate-900/30"} ${P?.isBelowThreshold?"border-red-500/50":""}`,onClick:()=>N(L?null:s.name),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:18,className:$?"text-sky-400":"text-slate-500"}),e.jsx("span",{className:"font-semibold text-white",children:s.name}),P?.isBelowThreshold&&e.jsx(Qe,{size:16,className:"text-red-400"})]}),$&&e.jsx("span",{className:"text-xs text-sky-400 bg-sky-900/30 px-2 py-0.5 rounded",children:t("tools.disk.monitoredBadge")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:(w||defaultTheme).colors.border.muted},children:e.jsxs("div",{className:"h-full flex",children:[e.jsx("div",{style:{width:`${o}%`,backgroundColor:(w||defaultTheme).colors.accent.primary},title:t("tools.disk.usedTooltip",{value:B(l)})}),e.jsx("div",{style:{width:`${u}%`,backgroundColor:(w||defaultTheme).colors.text.muted},title:t("tools.disk.freeTooltip",{value:B(s.freeBytes)})})]})}),e.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:t("tools.disk.total")}),e.jsx("span",{className:"text-slate-300",children:B(s.totalBytes)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:t("tools.disk.used")}),e.jsxs("span",{className:"text-slate-300",children:[B(l)," (",o.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:t("tools.disk.free")}),e.jsxs("span",{className:"text-slate-300",children:[B(s.freeBytes)," (",u.toFixed(1),"%)"]})]})]})]})]},s.name)})})]}),f&&i&&e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h4",{className:"panel-title",children:t("tools.disk.configureDrive",{drive:f})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{label:t("tools.disk.enableDrive"),description:`Monitor ${f} drive`,enabled:d?.enabled??!1,onChange:s=>x(f,{enabled:s}),icon:e.jsx(ne,{size:18})}),(d?.enabled??!1)&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.disk.checkInterval")}),e.jsx("input",{type:"number",min:1,max:1440,className:"input-text",value:d?.checkIntervalMinutes??15,onChange:s=>x(f,{checkIntervalMinutes:Number(s.target.value)})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t("tools.disk.checkIntervalHint")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-2",children:t("tools.disk.thresholdTitle")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 mb-1",children:[e.jsx("input",{type:"radio",name:`threshold-type-${f}`,checked:d?.thresholdPercent!==null&&d?.thresholdPercent!==void 0,onChange:()=>x(f,{thresholdPercent:10,thresholdBytes:null}),className:"radio"}),t("tools.disk.thresholdPercent")]}),d?.thresholdPercent!==null&&d?.thresholdPercent!==void 0&&e.jsx("input",{type:"number",min:1,max:100,className:"input-text mt-1",value:d.thresholdPercent,onChange:s=>x(f,{thresholdPercent:Number(s.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 mb-1",children:[e.jsx("input",{type:"radio",name:`threshold-type-${f}`,checked:d?.thresholdBytes!==null&&d?.thresholdBytes!==void 0,onChange:()=>x(f,{thresholdBytes:1024*1024*1024,thresholdPercent:null}),className:"radio"}),t("tools.disk.thresholdBytes")]}),d?.thresholdBytes!==null&&d?.thresholdBytes!==void 0&&e.jsx("input",{type:"number",min:0,step:1,className:"input-text mt-1",value:Math.round(d.thresholdBytes/(1024*1024)),onChange:s=>x(f,{thresholdBytes:Number(s.target.value)*1024*1024})})]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:t("tools.disk.thresholdHint")})]}),m&&e.jsxs("div",{className:`p-3 rounded-lg border ${m.isBelowThreshold?"border-red-500/50 bg-red-900/20":"border-slate-800 bg-slate-900/30"}`,children:[e.jsx("p",{className:"text-sm font-semibold text-white mb-1",children:t("tools.disk.statusCardTitle")}),e.jsxs("p",{className:"text-xs text-slate-400",children:[B(m.freeBytes)," ",t("tools.disk.free")," (",m.freePercent.toFixed(1),"%)",m.isBelowThreshold&&e.jsxs("span",{className:"text-red-400 ml-2",children:["⚠ ",t("tools.disk.belowThreshold")]})]}),m.lastAlertSent&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t("tools.disk.lastAlert",{value:re(m.lastAlertSent)})})]})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"panel-title",children:t("tools.disk.folderMonitoring")}),e.jsx("button",{className:"btn-outline text-xs",onClick:()=>{y(s=>({...s,folderMonitors:[...s.folderMonitors,{path:"",enabled:!0,checkIntervalMinutes:15,thresholdBytes:1024*1024*1024,thresholdDirection:"Over"}]}))},children:t("tools.disk.addFolder")})]}),g.folderMonitors.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:t("tools.disk.noFolders")}):e.jsx("div",{className:"space-y-3",children:Array.isArray(g.folderMonitors)&&g.folderMonitors.map((s,l)=>e.jsxs("div",{className:"p-4 border border-slate-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{label:t("tools.disk.enableFolder"),description:W(s.path)||"Folder monitor",enabled:s.enabled,onChange:o=>{y(u=>({...u,folderMonitors:Array.isArray(u.folderMonitors)?u.folderMonitors.map((j,P)=>P===l?{...j,enabled:o}:j):[]}))},icon:e.jsx(xe,{size:18})}),e.jsx("button",{className:"icon-btn text-red-400",onClick:()=>{y(o=>({...o,folderMonitors:Array.isArray(o.folderMonitors)?o.folderMonitors.filter((u,j)=>j!==l):[]}))},children:e.jsx(J,{size:16})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.disk.folderPath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input-text flex-1",value:W(s.path),onChange:o=>{const u=o.target.value.replace(/\\\\/g,"\\");y(j=>({...j,folderMonitors:Array.isArray(j.folderMonitors)?j.folderMonitors.map((P,L)=>L===l?{...P,path:u}:P):[]}))},placeholder:t("tools.disk.folderPlaceholder")}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>z(l),children:e.jsx(xe,{size:16})})]}),O===l&&e.jsx(Ke,{initialPath:s.path,onSelect:o=>{const u=o.replace(/\\\\/g,"\\");y(j=>({...j,folderMonitors:Array.isArray(j.folderMonitors)?j.folderMonitors.map((P,L)=>L===l?{...P,path:u}:P):[]})),z(null)},onCancel:()=>z(null)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.disk.checkInterval")}),e.jsx("input",{type:"number",min:1,max:1440,className:"input-text",value:s.checkIntervalMinutes,onChange:o=>{y(u=>({...u,folderMonitors:Array.isArray(u.folderMonitors)?u.folderMonitors.map((j,P)=>P===l?{...j,checkIntervalMinutes:Number(o.target.value)}:j):[]}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.disk.thresholdDirection")}),e.jsxs("select",{className:"input-text",value:s.thresholdDirection||"Over",onChange:o=>{y(u=>({...u,folderMonitors:Array.isArray(u.folderMonitors)?u.folderMonitors.map((j,P)=>P===l?{...j,thresholdDirection:o.target.value}:j):[]}))},children:[e.jsx("option",{value:"Over",children:t("tools.disk.thresholdOver")}),e.jsx("option",{value:"Under",children:t("tools.disk.thresholdUnder")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.disk.thresholdValue")}),e.jsx("input",{type:"number",min:0,step:1,className:"input-text",value:Math.round(s.thresholdBytes/(1024*1024)),onChange:o=>{y(u=>({...u,folderMonitors:Array.isArray(u.folderMonitors)?u.folderMonitors.map((j,P)=>P===l?{...j,thresholdBytes:Number(o.target.value)*1024*1024}:j):[]}))}})]}),e.jsx("p",{className:"text-xs text-slate-500",children:s.thresholdDirection==="Under"?t("tools.disk.thresholdSummaryUnder",{value:B(s.thresholdBytes)}):t("tools.disk.thresholdSummaryOver",{value:B(s.thresholdBytes)})})]},l))})]}),e.jsx(G,{name:"DiskMonitor",title:t("tools.disk.logTitle"),subfolder:"DiskMonitor"})]})}function ms({t}){const[w,A]=c.useState(!1),[S,f]=c.useState(!1),[N,O]=c.useState(null),[z,I]=c.useState(new Set),{data:n,mutate:h}=U("application-monitor-config",()=>D("/api/application-monitor/config")),[k,b]=c.useState({enabled:!1,applications:[],notificationRecipients:[]});c.useEffect(()=>{n&&b({...n,notificationRecipients:Array.isArray(n.notificationRecipients)?n.notificationRecipients:[]})},[n]);const g=c.useCallback(async()=>{A(!0);try{await D("/api/application-monitor/config",{method:"PUT",body:JSON.stringify(k)}),await h(),v(t("tools.app.saveSuccess"),"success")}catch(i){console.error("Failed to save application monitor config:",i);const d=i instanceof Error?i.message:String(i);v(t("tools.app.saveFailure",{message:d}),"error")}finally{A(!1)}},[k,h,t]),y=c.useCallback(()=>{const i=pe();b(d=>({...d,applications:[...d.applications,{id:i,name:"",executablePath:"",arguments:null,workingDirectory:null,enabled:!0,checkIntervalSeconds:60,restartDelaySeconds:5,logPath:null,eventLogSource:null}]})),I(d=>new Set([...d,i]))},[]),C=c.useCallback((i,d)=>{b(m=>({...m,applications:Array.isArray(m.applications)?m.applications.map(R=>R.id===i?{...R,...d}:R):[]}))},[]),x=c.useCallback(i=>{if(N){const d=i.replace(/\\\\/g,"\\");C(N,{executablePath:d})}f(!1),O(null)},[N,C]),F=c.useCallback(i=>{b(d=>({...d,applications:Array.isArray(d.applications)?d.applications.filter(m=>m.id!==i):[]}))},[]),M=c.useCallback(()=>{const i=window.prompt(t("tools.app.recipientPrompt"));i&&b(d=>{const m=Array.isArray(d.notificationRecipients)?d.notificationRecipients:[];return m.includes(i)?d:{...d,notificationRecipients:[...m,i]}})},[t]),E=c.useCallback(i=>{b(d=>({...d,notificationRecipients:Array.isArray(d.notificationRecipients)?d.notificationRecipients.filter(m=>m!==i):[]}))},[]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"panel-title mb-1",children:t("tools.app.title")}),e.jsx("p",{className:"text-sm text-slate-400",children:t("tools.app.subtitle")})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{className:"btn-primary",onClick:g,disabled:w,children:[e.jsx(oe,{size:16})," ",t(w?"tools.app.saving":"tools.app.save")]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{label:t("tools.app.enable"),description:"Monitor application status",enabled:k.enabled,onChange:i=>b(d=>({...d,enabled:i})),icon:e.jsx(Q,{size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:t("tools.app.recipients")}),e.jsx("button",{className:"btn-outline text-xs",onClick:M,children:t("tools.app.addRecipient")})]}),e.jsxs("div",{className:"space-y-1",children:[Array.isArray(k.notificationRecipients)&&k.notificationRecipients.map(i=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:i}),e.jsx("button",{className:"icon-btn",onClick:()=>E(i),children:"×"})]},i)),(!k.notificationRecipients||k.notificationRecipients.length===0)&&e.jsx("p",{className:"text-xs text-slate-500",children:t("tools.app.noRecipients")})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-slate-400",children:t("tools.app.listTitle")}),e.jsx("button",{className:"btn-outline text-xs",onClick:y,children:t("tools.app.addApplication")})]}),k.applications.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:t("tools.app.empty")}):e.jsx("div",{className:"space-y-2",children:Array.isArray(k.applications)&&k.applications.map(i=>{const d=z.has(i.id);return e.jsxs("div",{className:"border border-slate-800 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{label:i.name||t("tools.app.namePlaceholder"),description:`Check: ${i.checkIntervalSeconds}s | Restart: ${i.restartDelaySeconds}s`,enabled:i.enabled,onChange:m=>C(i.id,{enabled:m}),icon:e.jsx(Q,{size:18})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"icon-btn text-slate-400 hover:text-white",onClick:()=>{I(m=>{const R=new Set(m);return R.has(i.id)?R.delete(i.id):R.add(i.id),R})},title:d?"Collapse":"Expand",children:d?e.jsx(De,{size:16}):e.jsx(ts,{size:16})}),e.jsx("button",{className:"icon-btn text-red-400 hover:text-red-300",onClick:()=>F(i.id),title:"Delete",children:e.jsx(J,{size:14})})]})]}),d&&e.jsxs("div",{className:"p-4 space-y-3 border-t border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.namePlaceholder")}),e.jsx("input",{type:"text",id:`app-name-${i.id}`,name:`app-name-${i.id}`,className:"input-text w-full",placeholder:t("tools.app.namePlaceholder"),value:i.name,onChange:m=>C(i.id,{name:m.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.executablePath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",id:`app-executable-${i.id}`,name:`app-executable-${i.id}`,className:"input-text flex-1",placeholder:t("tools.app.executablePlaceholder"),value:W(i.executablePath||""),onChange:m=>{const R=m.target.value.replace(/\\\\/g,"\\");C(i.id,{executablePath:R})}}),e.jsx("button",{className:"btn-outline",onClick:()=>{O(i.id),f(!0)},children:e.jsx(xe,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.checkInterval")}),e.jsx("input",{type:"number",min:1,max:3600,className:"input-text",value:i.checkIntervalSeconds,onChange:m=>C(i.id,{checkIntervalSeconds:Number(m.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.restartDelay")}),e.jsx("input",{type:"number",min:0,max:300,className:"input-text",value:i.restartDelaySeconds,onChange:m=>C(i.id,{restartDelaySeconds:Number(m.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.arguments")}),e.jsx("input",{type:"text",className:"input-text",placeholder:t("tools.app.argumentsPlaceholder"),value:i.arguments||"",onChange:m=>C(i.id,{arguments:m.target.value||null})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.workingDirectory")}),e.jsx("input",{type:"text",className:"input-text",placeholder:t("tools.app.workingPlaceholder"),value:W(i.workingDirectory||""),onChange:m=>{const R=m.target.value.replace(/\\\\/g,"\\");C(i.id,{workingDirectory:R||null})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:t("tools.app.eventLogSource")}),e.jsx("input",{type:"text",className:"input-text w-full",placeholder:t("tools.app.eventLogPlaceholder"),value:i.eventLogSource||"",onChange:m=>C(i.id,{eventLogSource:m.target.value||null})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t("tools.app.eventLogHint")})]})]})]},i.id)})})]})]})]}),e.jsx(G,{name:"ApplicationMonitor",title:t("tools.app.logTitle"),subfolder:"ApplicationMonitor"}),S&&e.jsx(rs,{initialPath:N&&(k.applications||[]).find(i=>i.id===N)?.executablePath||"",onSelect:x,onCancel:()=>{f(!1),O(null)},fileExtensions:[".exe",".bat",".cmd",".com",".scr",".vbs",".js",".ps1"]})]})}function hs({t}){const[w,A]=c.useState(null),[S,f]=c.useState(!1),[N,O]=c.useState(!1),z=async n=>{O(!0),f(!1);try{if(w)try{await ke(w.id)}catch{}const h=await Se(n);A(h),v(`Terminal created (${n})`,"success")}catch(h){v(`Failed to create terminal: ${h instanceof Error?h.message:"Unknown error"}`,"error")}finally{O(!1)}},I=async()=>{if(w)try{await ke(w.id),A(null),v("Terminal closed","success")}catch(n){v(`Failed to close terminal: ${n instanceof Error?n.message:"Unknown error"}`,"error")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"panel-title mb-0",children:"Terminal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[w&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn-outline",onClick:async()=>{try{const h=`/terminal-popup?id=${(await Se(w.shellType)).id}`;window.open(h,"_blank","width=800,height=600")}catch(n){v(`Failed to open popup: ${n instanceof Error?n.message:"Unknown error"}`,"error")}},title:"Open terminal in a new window",children:[e.jsx(Ye,{size:16})," Open in Popup"]}),e.jsxs("button",{className:"btn-outline",onClick:I,children:[e.jsx(Z,{size:16})," Close Terminal"]})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>f(!0),disabled:N,children:[e.jsx(he,{size:16})," New Terminal"]})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Select Shell"}),e.jsx("button",{className:"text-slate-400 hover:text-white",onClick:()=>f(!1),children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full p-4 bg-slate-900/50 hover:bg-slate-900 border border-slate-700 rounded-lg text-left transition-colors",onClick:()=>z("cmd"),children:[e.jsx("div",{className:"font-medium text-white",children:"Command Prompt (cmd.exe)"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Windows Command Prompt"})]}),e.jsxs("button",{className:"w-full p-4 bg-slate-900/50 hover:bg-slate-900 border border-slate-700 rounded-lg text-left transition-colors",onClick:()=>z("powershell"),children:[e.jsx("div",{className:"font-medium text-white",children:"PowerShell"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Windows PowerShell"})]})]})]})}),w?e.jsx("div",{className:"h-[600px]",children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full bg-slate-900 rounded-lg border border-slate-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-sky-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Loading terminal..."})]})}),children:e.jsx(os,{sessionId:w.id,onClose:I})})}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(he,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"No active terminal"}),e.jsx("p",{className:"text-sm",children:'Click "New Terminal" to create one'})]})]}),e.jsx(us,{t})]})}function xs({t}){return e.jsx(G,{name:"Screenshots",title:t("tools.screenshots.logTitle"),subfolder:"Screenshots"})}function us({t}){return e.jsx(G,{name:"Terminal",title:t("tools.terminal.logTitle"),subfolder:"Terminal"})}function ps({t}){return e.jsx(G,{name:"VNC",title:t("tools.vnc.logTitle"),subfolder:"VNC"})}function fs({t}){const[w,A]=c.useState(!1),[S,f]=c.useState(!1),[N,O]=c.useState(""),[z,I]=c.useState([]),[n,h]=c.useState(null),[k,b]=c.useState(!1),{data:g}=U("vnc-config",()=>D("/api/vnc/config")),{data:y,mutate:C}=U("vnc-status",()=>D("/api/vnc/status"),{refreshInterval:2e3,revalidateOnFocus:!0,revalidateOnReconnect:!0});c.useEffect(()=>{C()},[C]),c.useEffect(()=>{const s=localStorage.getItem("weasel.vnc.profiles");if(s)try{const l=JSON.parse(s),o=l.map(u=>u.isDefault&&u.name==="Weasel Internal VNC Server"?{...u,name:"Weasel VNC Server"}:u);JSON.stringify(l)!==JSON.stringify(o)&&localStorage.setItem("weasel.vnc.profiles",JSON.stringify(o)),I(o)}catch(l){console.error("Failed to load VNC profiles:",l)}if(!s||JSON.parse(s).length===0){const l={id:pe(),name:"Weasel VNC Server",server:y?.allowRemote?window.location.hostname:"127.0.0.1",port:g?.port||5900,viewOnly:!1,shared:!0,encrypt:!1,resize:!1,quality:6,compression:2,isDefault:!0};I([l]),localStorage.setItem("weasel.vnc.profiles",JSON.stringify([l]))}},[g,y]);const x=async()=>{A(!0);try{await D("/api/vnc/start",{method:"POST"}),await C(),v(t("tools.vnc.startSuccess"),"success")}catch(s){v(t("tools.vnc.startFailure",{message:s instanceof Error?s.message:String(s)}),"error")}finally{A(!1)}},F=async()=>{f(!0);try{await D("/api/vnc/stop",{method:"POST"}),await C(),v(t("tools.vnc.stopSuccess"),"success")}catch(s){v(t("tools.vnc.stopFailure",{message:s instanceof Error?s.message:String(s)}),"error")}finally{f(!1)}},M=async s=>{console.log("[VNC] Connecting to profile:",s.name,s);let l=s.password;if(s.isDefault&&!l&&g?.hasPassword)try{console.log("[VNC] Fetching password for default profile"),l=(await D("/api/vnc/password")).password,console.log("[VNC] Password fetched successfully")}catch(P){console.error("Failed to fetch VNC password:",P),v("Failed to retrieve VNC server password","error");return}else if(!s.isDefault&&!l){console.log("[VNC] Prompting for password for non-default profile");const P=prompt(`Enter password for ${s.name} (leave empty if no password):`);P?(l=P,console.log("[VNC] Password entered")):console.log("[VNC] No password entered")}console.log("[VNC] Password available:",!!l),console.log("[VNC] Password length:",l?.length||0),l&&l.length>0&&console.log("[VNC] Password check (first/last char):",l.charAt(0),l.charAt(l.length-1)),localStorage.setItem("vnc_host",s.server),localStorage.setItem("vnc_port",s.port.toString()),localStorage.setItem("vnc_viewOnly",s.viewOnly.toString()),localStorage.setItem("vnc_shared",s.shared.toString()),localStorage.setItem("vnc_quality",s.quality.toString()),localStorage.setItem("vnc_compression",s.compression.toString()),l?localStorage.setItem("vnc_password",l):localStorage.removeItem("vnc_password");const o=new URLSearchParams;o.set("host",s.server),o.set("port",s.port.toString()),o.set("viewOnly",s.viewOnly.toString()),o.set("shared",s.shared.toString()),o.set("quality",s.quality.toString()),o.set("compression",s.compression.toString()),o.set("profileId",s.id),o.set("profileName",s.name),l&&o.set("password",l);const u=`/vnc-viewer?${o.toString()}`;console.log("[VNC] Opening popup with URL:",u);const j=window.open(u,`VNC Viewer - ${s.name}`,`width=${screen.width},height=${screen.height},fullscreen=yes,resizable=yes,scrollbars=no`);console.log("[VNC] Popup opened:",!!j,"closed:",j?.closed),!j||j.closed||typeof j.closed>"u"?(console.error("[VNC] Popup blocked or failed to open"),v("Popup blocked. Please allow popups for this site to connect to VNC.","error")):console.log("[VNC] Connection successful")},E=()=>{const s={id:pe(),name:"New VNC Server",server:"localhost",port:5900,viewOnly:!1,shared:!1,encrypt:!1,resize:!1,quality:6,compression:2,isDefault:!1};h(s),b(!0)},i=s=>{h({...s}),b(!0)},d=()=>{if(!n)return;const s=z.find(l=>l.id===n.id)?z.map(l=>l.id===n.id?n:l):[...z,n];I(s),localStorage.setItem("weasel.vnc.profiles",JSON.stringify(s)),b(!1),h(null),v("VNC profile saved successfully","success")},m=s=>{if(z.find(u=>u.id===s)?.isDefault){v("Cannot delete the default internal VNC server profile","error");return}const o=z.filter(u=>u.id!==s);I(o),localStorage.setItem("weasel.vnc.profiles",JSON.stringify(o)),v("VNC profile deleted successfully","success")};if(!g)return e.jsx("div",{className:"text-sm text-slate-400",children:t("tools.vnc.loading")});const R=y?.allowRemote?window.location.hostname:"127.0.0.1",_=y?.isRunning?`${R}:${y.port}`:null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"panel space-y-4",children:[e.jsx("h3",{className:"panel-title mb-0",children:t("tools.vnc.statusTitle")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:t("tools.vnc.status")}),e.jsx("span",{className:`text-sm font-semibold ${y?.isRunning?"text-green-400":"text-slate-400"}`,children:y?.isRunning?t("tools.vnc.running"):t("tools.vnc.stopped")})]}),y?.isRunning&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:t("tools.vnc.connections")}),e.jsx("span",{className:"text-sm font-semibold text-white",children:y.connectionCount})]}),_&&e.jsxs("div",{className:"bg-slate-900/60 rounded-lg p-3 border border-slate-800",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:t("tools.vnc.connectionInfo")}),e.jsx("p",{className:"text-sm font-mono text-white",children:_}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:t("tools.vnc.connectionHint")})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[y?.isRunning?e.jsx("button",{className:"btn-outline flex-1",onClick:F,disabled:w||S,children:t(S?"tools.vnc.stopping":"tools.vnc.stop")}):e.jsx("button",{className:"btn-primary flex-1",onClick:x,disabled:w||S||!g.enabled,children:w?t("tools.vnc.starting"):"Start Server"}),e.jsx("button",{className:"btn-outline",onClick:()=>C(),children:e.jsx(ie,{size:16})})]})]})]}),e.jsxs("div",{className:"panel space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"panel-title mb-0",children:"VNC Server Profiles"}),e.jsxs("button",{className:"btn-outline text-xs",onClick:E,children:[e.jsx(Q,{size:14})," Add Profile"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[z.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border transition-colors ${s.isDefault?"border-sky-500/50 bg-sky-900/20":"border-slate-800 bg-slate-900/30"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-white truncate",children:s.name}),s.isDefault&&e.jsx("span",{className:"text-xs text-sky-400 bg-sky-900/30 px-2 py-0.5 rounded mt-1 inline-block",children:"Default"})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{className:"icon-btn text-slate-400 hover:text-white",onClick:()=>i(s),title:"Edit",children:e.jsx(ls,{size:14})}),!s.isDefault&&e.jsx("button",{className:"icon-btn text-red-400 hover:text-red-300",onClick:()=>m(s.id),title:"Delete",children:e.jsx(J,{size:14})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Server:"}),e.jsxs("span",{className:"text-white font-mono truncate ml-2",children:[s.server,":",s.port]})]}),e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"View Only:"}),e.jsx("span",{className:s.viewOnly?"text-green-400":"text-slate-500",children:s.viewOnly?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Shared:"}),e.jsx("span",{className:s.shared?"text-green-400":"text-slate-500",children:s.shared?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Quality:"}),e.jsx("span",{className:"text-white",children:s.quality})]}),e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Compression:"}),e.jsx("span",{className:"text-white",children:s.compression})]}),s.encrypt&&e.jsxs("div",{className:"flex items-center gap-1 text-green-400 text-xs",children:[e.jsx(es,{size:12}),e.jsx("span",{children:"Encrypted"})]})]}),e.jsxs("button",{className:"btn-primary w-full mt-3",onClick:()=>{M(s).catch(l=>{console.error("[VNC] Connection error:",l),v(`Failed to connect: ${l instanceof Error?l.message:String(l)}`,"error")})},children:[e.jsx(ue,{size:14})," Connect"]})]},s.id)),z.length===0&&e.jsxs("div",{className:"col-span-full text-center py-8 text-slate-400",children:[e.jsx(Q,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No VNC server profiles configured"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:'Click "Add Profile" to create one'})]})]})]}),k&&n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white",children:[z.find(s=>s.id===n.id)?"Edit":"Add"," VNC Server Profile"]}),e.jsx("button",{className:"text-slate-400 hover:text-white",onClick:()=>{b(!1),h(null)},children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Profile Name"}),e.jsx("input",{type:"text",className:"input-text w-full",value:n.name,onChange:s=>h({...n,name:s.target.value}),placeholder:"My VNC Server"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Server/IP"}),e.jsx("input",{type:"text",className:"input-text w-full",value:n.server,onChange:s=>h({...n,server:s.target.value}),placeholder:"localhost or 192.168.1.100",disabled:n.isDefault})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Port"}),e.jsx("input",{type:"number",className:"input-text w-full",value:n.port,onChange:s=>h({...n,port:parseInt(s.target.value)||5900}),disabled:n.isDefault})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"viewOnly",className:"checkbox",checked:n.viewOnly,onChange:s=>h({...n,viewOnly:s.target.checked})}),e.jsx("label",{htmlFor:"viewOnly",className:"text-sm text-slate-300",children:"View Only"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"shared",className:"checkbox",checked:n.shared,onChange:s=>h({...n,shared:s.target.checked})}),e.jsx("label",{htmlFor:"shared",className:"text-sm text-slate-300",children:"Shared"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"encrypt",className:"checkbox",checked:n.encrypt,onChange:s=>h({...n,encrypt:s.target.checked})}),e.jsx("label",{htmlFor:"encrypt",className:"text-sm text-slate-300",children:"Encrypt"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"resize",className:"checkbox",checked:n.resize,onChange:s=>h({...n,resize:s.target.checked})}),e.jsx("label",{htmlFor:"resize",className:"text-sm text-slate-300",children:"Resize"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Quality (0-9)"}),e.jsx("input",{type:"number",min:"0",max:"9",className:"input-text w-full",value:n.quality,onChange:s=>h({...n,quality:Math.min(9,Math.max(0,parseInt(s.target.value)||0))})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"0 = best quality, 9 = best compression"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Compression (0-9)"}),e.jsx("input",{type:"number",min:"0",max:"9",className:"input-text w-full",value:n.compression,onChange:s=>h({...n,compression:Math.min(9,Math.max(0,parseInt(s.target.value)||0))})}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"0 = no compression, 9 = max compression"})]})]}),!n.isDefault&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Repeater ID (optional)"}),e.jsx("input",{type:"text",className:"input-text w-full",value:n.repeaterId||"",onChange:s=>h({...n,repeaterId:s.target.value||void 0}),placeholder:"ID:1234567890"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Password (optional)"}),e.jsx("input",{type:"password",className:"input-text w-full",value:n.password||"",onChange:s=>h({...n,password:s.target.value||void 0}),placeholder:"Leave empty to prompt on connect"})]})]}),n.isDefault&&e.jsx("div",{className:"bg-blue-900/20 border border-blue-500/50 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[e.jsx("strong",{children:"Note:"})," This is the internal Weasel VNC Server. Server, port, and password settings are managed in Settings → VNC."]})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{className:"btn-primary flex-1",onClick:d,children:[e.jsx(oe,{size:16})," Save Profile"]}),e.jsx("button",{className:"btn-outline flex-1",onClick:()=>{b(!1),h(null)},children:"Cancel"})]})]})]})}),e.jsx(ps,{t})]})}export{Ps as default};
